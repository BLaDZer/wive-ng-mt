diff -uNrwB radvd-2.16/aclocal.m4 radvd-2.17/aclocal.m4
--- radvd-2.16/aclocal.m4	2017-02-01 14:06:15.000000000 +0500
+++ radvd-2.17/aclocal.m4	2017-07-04 08:29:59.000000000 +0500
@@ -20,32 +20,63 @@
 If you have problems, you may need to regenerate the build system entirely.
 To do so, use the procedure documented by the package, typically 'autoreconf'.])])
 
-# pkg.m4 - Macros to locate and utilise pkg-config.            -*- Autoconf -*-
-# serial 1 (pkg-config-0.24)
-# 
-# Copyright © 2004 Scott James Remnant <scott@netsplit.com>.
-#
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful, but
-# WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-# General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
-#
-# As a special exception to the GNU General Public License, if you
-# distribute this file as part of a program that contains a
-# configuration script generated by Autoconf, you may include it under
-# the same distribution terms that you use for the rest of that program.
-
-# PKG_PROG_PKG_CONFIG([MIN-VERSION])
-# ----------------------------------
+dnl pkg.m4 - Macros to locate and utilise pkg-config.   -*- Autoconf -*-
+dnl serial 11 (pkg-config-0.29.1)
+dnl
+dnl Copyright © 2004 Scott James Remnant <scott@netsplit.com>.
+dnl Copyright © 2012-2015 Dan Nicholson <dbn.lists@gmail.com>
+dnl
+dnl This program is free software; you can redistribute it and/or modify
+dnl it under the terms of the GNU General Public License as published by
+dnl the Free Software Foundation; either version 2 of the License, or
+dnl (at your option) any later version.
+dnl
+dnl This program is distributed in the hope that it will be useful, but
+dnl WITHOUT ANY WARRANTY; without even the implied warranty of
+dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+dnl General Public License for more details.
+dnl
+dnl You should have received a copy of the GNU General Public License
+dnl along with this program; if not, write to the Free Software
+dnl Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+dnl 02111-1307, USA.
+dnl
+dnl As a special exception to the GNU General Public License, if you
+dnl distribute this file as part of a program that contains a
+dnl configuration script generated by Autoconf, you may include it under
+dnl the same distribution terms that you use for the rest of that
+dnl program.
+
+dnl PKG_PREREQ(MIN-VERSION)
+dnl -----------------------
+dnl Since: 0.29
+dnl
+dnl Verify that the version of the pkg-config macros are at least
+dnl MIN-VERSION. Unlike PKG_PROG_PKG_CONFIG, which checks the user's
+dnl installed version of pkg-config, this checks the developer's version
+dnl of pkg.m4 when generating configure.
+dnl
+dnl To ensure that this macro is defined, also add:
+dnl m4_ifndef([PKG_PREREQ],
+dnl     [m4_fatal([must install pkg-config 0.29 or later before running autoconf/autogen])])
+dnl
+dnl See the "Since" comment for each macro you use to see what version
+dnl of the macros you require.
+m4_defun([PKG_PREREQ],
+[m4_define([PKG_MACROS_VERSION], [0.29.1])
+m4_if(m4_version_compare(PKG_MACROS_VERSION, [$1]), -1,
+    [m4_fatal([pkg.m4 version $1 or higher is required but ]PKG_MACROS_VERSION[ found])])
+])dnl PKG_PREREQ
+
+dnl PKG_PROG_PKG_CONFIG([MIN-VERSION])
+dnl ----------------------------------
+dnl Since: 0.16
+dnl
+dnl Search for the pkg-config tool and set the PKG_CONFIG variable to
+dnl first found in the path. Checks that the version of pkg-config found
+dnl is at least MIN-VERSION. If MIN-VERSION is not specified, 0.9.0 is
+dnl used since that's the first version where most current features of
+dnl pkg-config existed.
 AC_DEFUN([PKG_PROG_PKG_CONFIG],
 [m4_pattern_forbid([^_?PKG_[A-Z_]+$])
 m4_pattern_allow([^PKG_CONFIG(_(PATH|LIBDIR|SYSROOT_DIR|ALLOW_SYSTEM_(CFLAGS|LIBS)))?$])
@@ -67,18 +98,19 @@
 		PKG_CONFIG=""
 	fi
 fi[]dnl
-])# PKG_PROG_PKG_CONFIG
+])dnl PKG_PROG_PKG_CONFIG
 
-# PKG_CHECK_EXISTS(MODULES, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
-#
-# Check to see whether a particular set of modules exists.  Similar
-# to PKG_CHECK_MODULES(), but does not set variables or print errors.
-#
-# Please remember that m4 expands AC_REQUIRE([PKG_PROG_PKG_CONFIG])
-# only at the first occurence in configure.ac, so if the first place
-# it's called might be skipped (such as if it is within an "if", you
-# have to call PKG_CHECK_EXISTS manually
-# --------------------------------------------------------------
+dnl PKG_CHECK_EXISTS(MODULES, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
+dnl -------------------------------------------------------------------
+dnl Since: 0.18
+dnl
+dnl Check to see whether a particular set of modules exists. Similar to
+dnl PKG_CHECK_MODULES(), but does not set variables or print errors.
+dnl
+dnl Please remember that m4 expands AC_REQUIRE([PKG_PROG_PKG_CONFIG])
+dnl only at the first occurence in configure.ac, so if the first place
+dnl it's called might be skipped (such as if it is within an "if", you
+dnl have to call PKG_CHECK_EXISTS manually
 AC_DEFUN([PKG_CHECK_EXISTS],
 [AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
 if test -n "$PKG_CONFIG" && \
@@ -88,8 +120,10 @@
   $3])dnl
 fi])
 
-# _PKG_CONFIG([VARIABLE], [COMMAND], [MODULES])
-# ---------------------------------------------
+dnl _PKG_CONFIG([VARIABLE], [COMMAND], [MODULES])
+dnl ---------------------------------------------
+dnl Internal wrapper calling pkg-config via PKG_CONFIG and setting
+dnl pkg_failed based on the result.
 m4_define([_PKG_CONFIG],
 [if test -n "$$1"; then
     pkg_cv_[]$1="$$1"
@@ -101,10 +135,11 @@
  else
     pkg_failed=untried
 fi[]dnl
-])# _PKG_CONFIG
+])dnl _PKG_CONFIG
 
-# _PKG_SHORT_ERRORS_SUPPORTED
-# -----------------------------
+dnl _PKG_SHORT_ERRORS_SUPPORTED
+dnl ---------------------------
+dnl Internal check to see if pkg-config supports short errors.
 AC_DEFUN([_PKG_SHORT_ERRORS_SUPPORTED],
 [AC_REQUIRE([PKG_PROG_PKG_CONFIG])
 if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
@@ -112,19 +147,17 @@
 else
         _pkg_short_errors_supported=no
 fi[]dnl
-])# _PKG_SHORT_ERRORS_SUPPORTED
+])dnl _PKG_SHORT_ERRORS_SUPPORTED
 
 
-# PKG_CHECK_MODULES(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
-# [ACTION-IF-NOT-FOUND])
-#
-#
-# Note that if there is a possibility the first call to
-# PKG_CHECK_MODULES might not happen, you should be sure to include an
-# explicit call to PKG_PROG_PKG_CONFIG in your configure.ac
-#
-#
-# --------------------------------------------------------------
+dnl PKG_CHECK_MODULES(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
+dnl   [ACTION-IF-NOT-FOUND])
+dnl --------------------------------------------------------------
+dnl Since: 0.4.0
+dnl
+dnl Note that if there is a possibility the first call to
+dnl PKG_CHECK_MODULES might not happen, you should be sure to include an
+dnl explicit call to PKG_PROG_PKG_CONFIG in your configure.ac
 AC_DEFUN([PKG_CHECK_MODULES],
 [AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
 AC_ARG_VAR([$1][_CFLAGS], [C compiler flags for $1, overriding pkg-config])dnl
@@ -178,16 +211,40 @@
         AC_MSG_RESULT([yes])
 	$3
 fi[]dnl
-])# PKG_CHECK_MODULES
+])dnl PKG_CHECK_MODULES
 
 
-# PKG_INSTALLDIR(DIRECTORY)
-# -------------------------
-# Substitutes the variable pkgconfigdir as the location where a module
-# should install pkg-config .pc files. By default the directory is
-# $libdir/pkgconfig, but the default can be changed by passing
-# DIRECTORY. The user can override through the --with-pkgconfigdir
-# parameter.
+dnl PKG_CHECK_MODULES_STATIC(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
+dnl   [ACTION-IF-NOT-FOUND])
+dnl ---------------------------------------------------------------------
+dnl Since: 0.29
+dnl
+dnl Checks for existence of MODULES and gathers its build flags with
+dnl static libraries enabled. Sets VARIABLE-PREFIX_CFLAGS from --cflags
+dnl and VARIABLE-PREFIX_LIBS from --libs.
+dnl
+dnl Note that if there is a possibility the first call to
+dnl PKG_CHECK_MODULES_STATIC might not happen, you should be sure to
+dnl include an explicit call to PKG_PROG_PKG_CONFIG in your
+dnl configure.ac.
+AC_DEFUN([PKG_CHECK_MODULES_STATIC],
+[AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
+_save_PKG_CONFIG=$PKG_CONFIG
+PKG_CONFIG="$PKG_CONFIG --static"
+PKG_CHECK_MODULES($@)
+PKG_CONFIG=$_save_PKG_CONFIG[]dnl
+])dnl PKG_CHECK_MODULES_STATIC
+
+
+dnl PKG_INSTALLDIR([DIRECTORY])
+dnl -------------------------
+dnl Since: 0.27
+dnl
+dnl Substitutes the variable pkgconfigdir as the location where a module
+dnl should install pkg-config .pc files. By default the directory is
+dnl $libdir/pkgconfig, but the default can be changed by passing
+dnl DIRECTORY. The user can override through the --with-pkgconfigdir
+dnl parameter.
 AC_DEFUN([PKG_INSTALLDIR],
 [m4_pushdef([pkg_default], [m4_default([$1], ['${libdir}/pkgconfig'])])
 m4_pushdef([pkg_description],
@@ -201,13 +258,15 @@
 ]) dnl PKG_INSTALLDIR
 
 
-# PKG_NOARCH_INSTALLDIR(DIRECTORY)
-# -------------------------
-# Substitutes the variable noarch_pkgconfigdir as the location where a
-# module should install arch-independent pkg-config .pc files. By
-# default the directory is $datadir/pkgconfig, but the default can be
-# changed by passing DIRECTORY. The user can override through the
-# --with-noarch-pkgconfigdir parameter.
+dnl PKG_NOARCH_INSTALLDIR([DIRECTORY])
+dnl --------------------------------
+dnl Since: 0.27
+dnl
+dnl Substitutes the variable noarch_pkgconfigdir as the location where a
+dnl module should install arch-independent pkg-config .pc files. By
+dnl default the directory is $datadir/pkgconfig, but the default can be
+dnl changed by passing DIRECTORY. The user can override through the
+dnl --with-noarch-pkgconfigdir parameter.
 AC_DEFUN([PKG_NOARCH_INSTALLDIR],
 [m4_pushdef([pkg_default], [m4_default([$1], ['${datadir}/pkgconfig'])])
 m4_pushdef([pkg_description],
@@ -221,10 +280,12 @@
 ]) dnl PKG_NOARCH_INSTALLDIR
 
 
-# PKG_CHECK_VAR(VARIABLE, MODULE, CONFIG-VARIABLE,
-# [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
-# -------------------------------------------
-# Retrieves the value of the pkg-config variable for the given module.
+dnl PKG_CHECK_VAR(VARIABLE, MODULE, CONFIG-VARIABLE,
+dnl [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
+dnl -------------------------------------------
+dnl Since: 0.28
+dnl
+dnl Retrieves the value of the pkg-config variable for the given module.
 AC_DEFUN([PKG_CHECK_VAR],
 [AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
 AC_ARG_VAR([$1], [value of $3 for $2, overriding pkg-config])dnl
@@ -233,7 +294,7 @@
 AS_VAR_COPY([$1], [pkg_cv_][$1])
 
 AS_VAR_IF([$1], [""], [$5], [$4])dnl
-])# PKG_CHECK_VAR
+])dnl PKG_CHECK_VAR
 
 # Copyright (C) 2002-2014 Free Software Foundation, Inc.
 #
diff -uNrwB radvd-2.16/CHANGES radvd-2.17/CHANGES
--- radvd-2.16/CHANGES	2017-02-01 14:05:19.000000000 +0500
+++ radvd-2.17/CHANGES	2017-07-04 08:29:35.000000000 +0500
@@ -1,3 +1,12 @@
+2017/07/03	Release v2.17
+
+2017/07/01	Fix STDERR_SYSLOG log level bug.
+		Always close stdout and stderr when daemonizing.
+
+2017/03/15	Implement RFC 7772 Section 5.1.1, 5.1.2, defaulted to on. <Robin H. Johnson>
+
+2017/02/04	clang-format the code
+
 2017/02/01	Release v2.16
 
 2017/01/10	Fixed ExecReload in systemd service file <Harald Albrecht>
diff -uNrwB radvd-2.16/config.guess radvd-2.17/config.guess
--- radvd-2.16/config.guess	2017-02-01 14:06:17.000000000 +0500
+++ radvd-2.17/config.guess	2017-07-04 08:30:01.000000000 +0500
@@ -1,8 +1,8 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
-#   Copyright 1992-2014 Free Software Foundation, Inc.
+#   Copyright 1992-2015 Free Software Foundation, Inc.
 
-timestamp='2014-03-23'
+timestamp='2015-08-20'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -24,12 +24,12 @@
 # program.  This Exception is an additional permission under section 7
 # of the GNU General Public License, version 3 ("GPLv3").
 #
-# Originally written by Per Bothner.
+# Originally written by Per Bothner; maintained since 2000 by Ben Elliston.
 #
 # You can get the latest version of this script from:
 # http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
 #
-# Please send patches with a ChangeLog entry to config-patches@gnu.org.
+# Please send patches to <config-patches@gnu.org>.
 
 
 me=`echo "$0" | sed -e 's,.*/,,'`
@@ -50,7 +50,7 @@
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright 1992-2014 Free Software Foundation, Inc.
+Copyright 1992-2015 Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -168,20 +168,27 @@
 	# Note: NetBSD doesn't particularly care about the vendor
 	# portion of the name.  We always set it to "unknown".
 	sysctl="sysctl -n hw.machine_arch"
-	UNAME_MACHINE_ARCH=`(/sbin/$sysctl 2>/dev/null || \
-	    /usr/sbin/$sysctl 2>/dev/null || echo unknown)`
+	UNAME_MACHINE_ARCH=`(uname -p 2>/dev/null || \
+	    /sbin/$sysctl 2>/dev/null || \
+	    /usr/sbin/$sysctl 2>/dev/null || \
+	    echo unknown)`
 	case "${UNAME_MACHINE_ARCH}" in
 	    armeb) machine=armeb-unknown ;;
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
 	    sh5el) machine=sh5le-unknown ;;
+	    earmv*)
+		arch=`echo ${UNAME_MACHINE_ARCH} | sed -e 's,^e\(armv[0-9]\).*$,\1,'`
+		endian=`echo ${UNAME_MACHINE_ARCH} | sed -ne 's,^.*\(eb\)$,\1,p'`
+		machine=${arch}${endian}-unknown
+		;;
 	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
 	# to ELF recently, or will in the future.
 	case "${UNAME_MACHINE_ARCH}" in
-	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
+	    arm*|earm*|i386|m68k|ns32k|sh3*|sparc|vax)
 		eval $set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2>/dev/null \
 			| grep -q __ELF__
@@ -197,6 +204,13 @@
 		os=netbsd
 		;;
 	esac
+	# Determine ABI tags.
+	case "${UNAME_MACHINE_ARCH}" in
+	    earm*)
+		expr='s/^earmv[0-9]/-eabi/;s/eb$//'
+		abi=`echo ${UNAME_MACHINE_ARCH} | sed -e "$expr"`
+		;;
+	esac
 	# The OS release
 	# Debian GNU/NetBSD machines have a different userland, and
 	# thus, need a distinct triplet. However, they do not need
@@ -207,13 +221,13 @@
 		release='-gnu'
 		;;
 	    *)
-		release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+		release=`echo ${UNAME_RELEASE} | sed -e 's/[-_].*//' | cut -d. -f1,2`
 		;;
 	esac
 	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
-	echo "${machine}-${os}${release}"
+	echo "${machine}-${os}${release}${abi}"
 	exit ;;
     *:Bitrig:*:*)
 	UNAME_MACHINE_ARCH=`arch | sed 's/Bitrig.//'`
@@ -235,6 +249,9 @@
     *:MirBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
 	exit ;;
+    *:Sortix:*:*)
+	echo ${UNAME_MACHINE}-unknown-sortix
+	exit ;;
     alpha:OSF1:*:*)
 	case $UNAME_RELEASE in
 	*4.0)
@@ -579,8 +596,9 @@
 	else
 		IBM_ARCH=powerpc
 	fi
-	if [ -x /usr/bin/oslevel ] ; then
-		IBM_REV=`/usr/bin/oslevel`
+	if [ -x /usr/bin/lslpp ] ; then
+		IBM_REV=`/usr/bin/lslpp -Lqc bos.rte.libc |
+			   awk -F: '{ print $3 }' | sed s/[0-9]*$/0/`
 	else
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
@@ -932,6 +950,9 @@
     crisv32:Linux:*:*)
 	echo ${UNAME_MACHINE}-axis-linux-${LIBC}
 	exit ;;
+    e2k:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
     frv:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
@@ -1020,7 +1041,7 @@
 	echo ${UNAME_MACHINE}-dec-linux-${LIBC}
 	exit ;;
     x86_64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	echo ${UNAME_MACHINE}-pc-linux-${LIBC}
 	exit ;;
     xtensa*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
diff -uNrwB radvd-2.16/config.sub radvd-2.17/config.sub
--- radvd-2.16/config.sub	2017-02-01 14:06:17.000000000 +0500
+++ radvd-2.17/config.sub	2017-07-04 08:30:01.000000000 +0500
@@ -1,8 +1,8 @@
 #! /bin/sh
 # Configuration validation subroutine script.
-#   Copyright 1992-2014 Free Software Foundation, Inc.
+#   Copyright 1992-2015 Free Software Foundation, Inc.
 
-timestamp='2014-09-11'
+timestamp='2015-08-20'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -25,7 +25,7 @@
 # of the GNU General Public License, version 3 ("GPLv3").
 
 
-# Please send patches with a ChangeLog entry to config-patches@gnu.org.
+# Please send patches to <config-patches@gnu.org>.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
@@ -68,7 +68,7 @@
 version="\
 GNU config.sub ($timestamp)
 
-Copyright 1992-2014 Free Software Foundation, Inc.
+Copyright 1992-2015 Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -117,7 +117,7 @@
 case $maybe_os in
   nto-qnx* | linux-gnu* | linux-android* | linux-dietlibc | linux-newlib* | \
   linux-musl* | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | \
-  knetbsd*-gnu* | netbsd*-gnu* | \
+  knetbsd*-gnu* | netbsd*-gnu* | netbsd*-eabi* | \
   kopensolaris*-gnu* | \
   storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
@@ -255,12 +255,13 @@
 	| arc | arceb \
 	| arm | arm[bl]e | arme[lb] | armv[2-8] | armv[3-8][lb] | armv7[arm] \
 	| avr | avr32 \
+	| ba \
 	| be32 | be64 \
 	| bfin \
 	| c4x | c8051 | clipper \
 	| d10v | d30v | dlx | dsp16xx \
-	| epiphany \
-	| fido | fr30 | frv \
+	| e2k | epiphany \
+	| fido | fr30 | frv | ft32 \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| hexagon \
 	| i370 | i860 | i960 | ia64 \
@@ -305,7 +306,7 @@
 	| riscv32 | riscv64 \
 	| rl78 | rx \
 	| score \
-	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[234]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
 	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
 	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
@@ -313,6 +314,7 @@
 	| tahoe | tic4x | tic54x | tic55x | tic6x | tic80 | tron \
 	| ubicom32 \
 	| v850 | v850e | v850e1 | v850e2 | v850es | v850e2v3 \
+	| visium \
 	| we32k \
 	| x86 | xc16x | xstormy16 | xtensa \
 	| z8k | z80)
@@ -327,6 +329,9 @@
 	c6x)
 		basic_machine=tic6x-unknown
 		;;
+	leon|leon[3-9])
+		basic_machine=sparc-$basic_machine
+		;;
 	m6811 | m68hc11 | m6812 | m68hc12 | m68hcs12x | nvptx | picochip)
 		basic_machine=$basic_machine-unknown
 		os=-none
@@ -372,12 +377,13 @@
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* | arceb-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
 	| avr-* | avr32-* \
+	| ba-* \
 	| be32-* | be64-* \
 	| bfin-* | bs2000-* \
 	| c[123]* | c30-* | [cjt]90-* | c4x-* \
 	| c8051-* | clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
-	| elxsi-* \
+	| e2k-* | elxsi-* \
 	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
@@ -424,12 +430,13 @@
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* \
 	| pyramid-* \
+	| riscv32-* | riscv64-* \
 	| rl78-* | romp-* | rs6000-* | rx-* \
 	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
 	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
 	| sparclite-* \
-	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx?-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx*-* \
 	| tahoe-* \
 	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
 	| tile*-* \
@@ -437,6 +444,7 @@
 	| ubicom32-* \
 	| v850-* | v850e-* | v850e1-* | v850es-* | v850e2-* | v850e2v3-* \
 	| vax-* \
+	| visium-* \
 	| we32k-* \
 	| x86-* | x86_64-* | xc16x-* | xps100-* \
 	| xstormy16-* | xtensa*-* \
@@ -513,6 +521,9 @@
 		basic_machine=i386-pc
 		os=-aros
 		;;
+        asmjs)
+		basic_machine=asmjs-unknown
+		;;
 	aux)
 		basic_machine=m68k-apple
 		os=-aux
@@ -774,6 +785,9 @@
 		basic_machine=m68k-isi
 		os=-sysv
 		;;
+	leon-*|leon[3-9]-*)
+		basic_machine=sparc-`echo $basic_machine | sed 's/-.*//'`
+		;;
 	m68knommu)
 		basic_machine=m68k-unknown
 		os=-linux
@@ -1365,7 +1379,7 @@
 	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
 	      | -sym* | -kopensolaris* | -plan9* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
-	      | -aos* | -aros* \
+	      | -aos* | -aros* | -cloudabi* | -sortix* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
 	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
diff -uNrwB radvd-2.16/configure radvd-2.17/configure
--- radvd-2.16/configure	2017-02-01 14:06:16.000000000 +0500
+++ radvd-2.17/configure	2017-07-04 08:30:00.000000000 +0500
@@ -1,6 +1,6 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.69 for radvd 2.16.
+# Generated by GNU Autoconf 2.69 for radvd 2.17.
 #
 #
 # Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
@@ -577,8 +577,8 @@
 # Identity of this package.
 PACKAGE_NAME='radvd'
 PACKAGE_TARNAME='radvd'
-PACKAGE_VERSION='2.16'
-PACKAGE_STRING='radvd 2.16'
+PACKAGE_VERSION='2.17'
+PACKAGE_STRING='radvd 2.17'
 PACKAGE_BUGREPORT=''
 PACKAGE_URL=''
 
@@ -726,6 +726,7 @@
 docdir
 oldincludedir
 includedir
+runstatedir
 localstatedir
 sharedstatedir
 sysconfdir
@@ -811,6 +812,7 @@
 sysconfdir='${prefix}/etc'
 sharedstatedir='${prefix}/com'
 localstatedir='${prefix}/var'
+runstatedir='${localstatedir}/run'
 includedir='${prefix}/include'
 oldincludedir='/usr/include'
 docdir='${datarootdir}/doc/${PACKAGE_TARNAME}'
@@ -1063,6 +1065,15 @@
   | -silent | --silent | --silen | --sile | --sil)
     silent=yes ;;
 
+  -runstatedir | --runstatedir | --runstatedi | --runstated \
+  | --runstate | --runstat | --runsta | --runst | --runs \
+  | --run | --ru | --r)
+    ac_prev=runstatedir ;;
+  -runstatedir=* | --runstatedir=* | --runstatedi=* | --runstated=* \
+  | --runstate=* | --runstat=* | --runsta=* | --runst=* | --runs=* \
+  | --run=* | --ru=* | --r=*)
+    runstatedir=$ac_optarg ;;
+
   -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
     ac_prev=sbindir ;;
   -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
@@ -1200,7 +1211,7 @@
 for ac_var in	exec_prefix prefix bindir sbindir libexecdir datarootdir \
 		datadir sysconfdir sharedstatedir localstatedir includedir \
 		oldincludedir docdir infodir htmldir dvidir pdfdir psdir \
-		libdir localedir mandir
+		libdir localedir mandir runstatedir
 do
   eval ac_val=\$$ac_var
   # Remove trailing slashes.
@@ -1313,7 +1324,7 @@
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures radvd 2.16 to adapt to many kinds of systems.
+\`configure' configures radvd 2.17 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1353,6 +1364,7 @@
   --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]
   --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]
   --localstatedir=DIR     modifiable single-machine data [PREFIX/var]
+  --runstatedir=DIR       modifiable per-process data [LOCALSTATEDIR/run]
   --libdir=DIR            object code libraries [EPREFIX/lib]
   --includedir=DIR        C header files [PREFIX/include]
   --oldincludedir=DIR     C header files for non-gcc [/usr/include]
@@ -1384,7 +1396,7 @@
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of radvd 2.16:";;
+     short | recursive ) echo "Configuration of radvd 2.17:";;
    esac
   cat <<\_ACEOF
 
@@ -1500,7 +1512,7 @@
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-radvd configure 2.16
+radvd configure 2.17
 generated by GNU Autoconf 2.69
 
 Copyright (C) 2012 Free Software Foundation, Inc.
@@ -1865,7 +1877,7 @@
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by radvd $as_me 2.16, which was
+It was created by radvd $as_me 2.17, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
@@ -2840,7 +2852,7 @@
 
 # Define the identity of the package.
  PACKAGE='radvd'
- VERSION='2.16'
+ VERSION='2.17'
 
 
 cat >>confdefs.h <<_ACEOF
@@ -6483,7 +6495,7 @@
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by radvd $as_me 2.16, which was
+This file was extended by radvd $as_me 2.17, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
@@ -6549,7 +6561,7 @@
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-radvd config.status 2.16
+radvd config.status 2.17
 configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
diff -uNrwB radvd-2.16/configure.ac radvd-2.17/configure.ac
--- radvd-2.16/configure.ac	2017-02-01 14:03:49.000000000 +0500
+++ radvd-2.17/configure.ac	2017-07-04 08:28:12.000000000 +0500
@@ -13,7 +13,7 @@
 dnl
 
 dnl If adding rcX to version, be sure to separate with a '-' 
-AC_INIT(radvd, [2.16])
+AC_INIT(radvd, [2.17])
 AC_CONFIG_SRCDIR(radvd.c)
 AC_CANONICAL_SYSTEM
 AM_INIT_AUTOMAKE
diff -uNrwB radvd-2.16/defaults.h radvd-2.17/defaults.h
--- radvd-2.16/defaults.h	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/defaults.h	2017-07-02 06:58:35.000000000 +0500
@@ -39,12 +39,15 @@
 #define DFLT_AdvLinkMTU			0
 #define DFLT_AdvReachableTime		0
 #define DFLT_AdvRetransTimer		0
-#define DFLT_AdvCurHopLimit		64	/* as per RFC 1700 or the
+#define DFLT_AdvCurHopLimit                                                                                                      \
+	64 /* as per RFC 1700 or the                                                                                             \
 						   next incarnation of it :) */
 #define DFLT_AdvDefaultLifetime(iface)	MAX2(1, (int)(3.0 * (iface)->MaxRtrAdvInterval))
 #define DFLT_MinDelayBetweenRAs		MIN_DELAY_BETWEEN_RAS
 #define DFLT_AdvDefaultPreference	0
 #define DFLT_AdvRAMTU			RFC2460_MIN_MTU
+#define DFLT_UnicastOnly 0
+#define DFLT_AdvRASolicitedUnicast 1
 
 /* Options sent with RA */
 
diff -uNrwB radvd-2.16/device-bsd44.c radvd-2.17/device-bsd44.c
--- radvd-2.16/device-bsd44.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/device-bsd44.c	2017-06-29 09:32:02.000000000 +0500
@@ -13,9 +13,9 @@
  */
 
 #include "config.h"
+#include "defaults.h"
 #include "includes.h"
 #include "radvd.h"
-#include "defaults.h"
 
 /*
  * this function gets the hardware type and address of an interface,
@@ -101,7 +101,8 @@
 		struct AdvPrefix *prefix = iface->AdvPrefixList;
 		while (prefix) {
 			if ((iface->sllao.if_prefix_len != -1) && (iface->sllao.if_prefix_len != prefix->PrefixLen)) {
-				flog(LOG_WARNING, "prefix length should be %d for %s", iface->sllao.if_prefix_len, iface->props.name);
+				flog(LOG_WARNING, "prefix length should be %d for %s", iface->sllao.if_prefix_len,
+				     iface->props.name);
 			}
 
 			prefix = prefix->next;
@@ -125,10 +126,7 @@
 	return -1;
 }
 
-int setup_allrouters_membership(int sock, struct Interface *iface)
-{
-	return 0;
-}
+int setup_allrouters_membership(int sock, struct Interface *iface) { return 0; }
 
 int set_interface_linkmtu(const char *iface, uint32_t mtu)
 {
diff -uNrwB radvd-2.16/device-common.c radvd-2.17/device-common.c
--- radvd-2.16/device-common.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/device-common.c	2017-06-29 09:32:02.000000000 +0500
@@ -13,10 +13,10 @@
  */
 
 #include "config.h"
-#include "includes.h"
-#include "radvd.h"
 #include "defaults.h"
+#include "includes.h"
 #include "pathnames.h"
+#include "radvd.h"
 
 int check_device(int sock, struct Interface *iface)
 {
@@ -87,11 +87,7 @@
 	return 0;
 }
 
-
-static int cmp_iface_addrs(void const *a, void const *b)
-{
-	return memcmp(a, b, sizeof(struct in6_addr));
-}
+static int cmp_iface_addrs(void const *a, void const *b) { return memcmp(a, b, sizeof(struct in6_addr)); }
 
 /*
  * Return first IPv6 link local addr in if_addr.
diff -uNrwB radvd-2.16/device-linux.c radvd-2.17/device-linux.c
--- radvd-2.16/device-linux.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/device-linux.c	2017-06-29 09:32:02.000000000 +0500
@@ -13,11 +13,11 @@
  */
 
 #include "config.h"
-#include "includes.h"
-#include "radvd.h"
 #include "defaults.h"
-#include "pathnames.h"
+#include "includes.h"
 #include "netlink.h"
+#include "pathnames.h"
+#include "radvd.h"
 
 #ifndef IPV6_ADDR_LINKLOCAL
 #define IPV6_ADDR_LINKLOCAL   0x0020U
@@ -62,7 +62,8 @@
 	 */
 	iface->props.max_ra_option_size = iface->AdvRAMTU;
 	iface->props.max_ra_option_size = MIN(iface->props.max_ra_option_size, MAX(iface->sllao.if_maxmtu, RFC2460_MIN_MTU));
-	iface->props.max_ra_option_size = MIN(iface->props.max_ra_option_size, MAX(get_interface_linkmtu(iface->props.name), RFC2460_MIN_MTU));
+	iface->props.max_ra_option_size =
+	    MIN(iface->props.max_ra_option_size, MAX(get_interface_linkmtu(iface->props.name), RFC2460_MIN_MTU));
 
 	if (ioctl(sock, SIOCGIFHWADDR, &ifr) < 0) {
 		flog(LOG_ERR, "ioctl(SIOCGIFHWADDR) failed on %s: %s", iface->props.name, strerror(errno));
@@ -75,16 +76,11 @@
 	case ARPHRD_ETHER:
 		iface->sllao.if_hwaddr_len = 48;
 		iface->sllao.if_prefix_len = 64;
-		/* *INDENT-OFF* */
 		char hwaddr[3 * 6];
-		sprintf(hwaddr, "%02x:%02x:%02x:%02x:%02x:%02x",
-			(unsigned char)ifr.ifr_hwaddr.sa_data[0],
-			(unsigned char)ifr.ifr_hwaddr.sa_data[1],
-			(unsigned char)ifr.ifr_hwaddr.sa_data[2],
-			(unsigned char)ifr.ifr_hwaddr.sa_data[3],
-			(unsigned char)ifr.ifr_hwaddr.sa_data[4],
+		sprintf(hwaddr, "%02x:%02x:%02x:%02x:%02x:%02x", (unsigned char)ifr.ifr_hwaddr.sa_data[0],
+			(unsigned char)ifr.ifr_hwaddr.sa_data[1], (unsigned char)ifr.ifr_hwaddr.sa_data[2],
+			(unsigned char)ifr.ifr_hwaddr.sa_data[3], (unsigned char)ifr.ifr_hwaddr.sa_data[4],
 			(unsigned char)ifr.ifr_hwaddr.sa_data[5]);
-		/* *INDENT-ON* */
 		dlog(LOG_DEBUG, 3, "%s hardware address: %s", iface->props.name, hwaddr);
 		iface->props.max_ra_option_size -= 14; /* RFC 2464 */
 		break;
@@ -206,8 +202,8 @@
 		}
 		fclose(fp);
 	} else {
-		flog(LOG_DEBUG,
-		     "Correct IPv6 MTU entry not found, " "perhaps the procfs is disabled, "
+		flog(LOG_DEBUG, "Correct IPv6 MTU entry not found, "
+				"perhaps the procfs is disabled, "
 		     "or the kernel interface has changed?");
 		value = 1280; /* RFC2460: section 5 */
 	}
@@ -215,25 +211,13 @@
 	return value;
 }
 
-int set_interface_linkmtu(const char *iface, uint32_t mtu)
-{
-	return privsep_interface_linkmtu(iface, mtu);
-}
+int set_interface_linkmtu(const char *iface, uint32_t mtu) { return privsep_interface_linkmtu(iface, mtu); }
 
-int set_interface_curhlim(const char *iface, uint8_t hlim)
-{
-	return privsep_interface_curhlim(iface, hlim);
-}
+int set_interface_curhlim(const char *iface, uint8_t hlim) { return privsep_interface_curhlim(iface, hlim); }
 
-int set_interface_reachtime(const char *iface, uint32_t rtime)
-{
-	return privsep_interface_reachtime(iface, rtime);
-}
+int set_interface_reachtime(const char *iface, uint32_t rtime) { return privsep_interface_reachtime(iface, rtime); }
 
-int set_interface_retranstimer(const char *iface, uint32_t rettimer)
-{
-	return privsep_interface_retranstimer(iface, rettimer);
-}
+int set_interface_retranstimer(const char *iface, uint32_t rettimer) { return privsep_interface_retranstimer(iface, rettimer); }
 
 int check_ip6_forwarding(void)
 {
@@ -249,8 +233,8 @@
 		}
 		fclose(fp);
 	} else {
-		flog(LOG_DEBUG,
-		     "Correct IPv6 forwarding procfs entry not found, " "perhaps the procfs is disabled, "
+		flog(LOG_DEBUG, "Correct IPv6 forwarding procfs entry not found, "
+				"perhaps the procfs is disabled, "
 		     "or the kernel interface has changed?");
 		value = -1;
 	}
@@ -259,8 +243,8 @@
 	int forw_sysctl[] = { SYSCTL_IP6_FORWARDING };
 	size_t size = sizeof(value);
 	if (!fp && sysctl(forw_sysctl, sizeof(forw_sysctl) / sizeof(forw_sysctl[0]), &value, &size, NULL, 0) < 0) {
-		flog(LOG_DEBUG,
-		     "Correct IPv6 forwarding sysctl branch not found, " "perhaps the kernel interface has changed?");
+		flog(LOG_DEBUG, "Correct IPv6 forwarding sysctl branch not found, "
+				"perhaps the kernel interface has changed?");
 		return 0;	/* this is of advisory value only */
 	}
 #endif
diff -uNrwB radvd-2.16/gram.y radvd-2.17/gram.y
--- radvd-2.16/gram.y	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/gram.y	2017-07-02 06:58:35.000000000 +0500
@@ -92,6 +92,7 @@
 %token		T_Base6Interface
 %token		T_Base6to4Interface
 %token		T_UnicastOnly
+%token		T_AdvRASolicitedUnicast
 
 %token		T_HomeAgentPreference
 %token		T_HomeAgentLifetime
@@ -332,6 +333,10 @@
 		{
 			iface->UnicastOnly = $2;
 		}
+		| T_AdvRASolicitedUnicast SWITCH ';'
+		{
+			iface->AdvRASolicitedUnicast = $2;
+		}
 		| T_AdvMobRtrSupportFlag SWITCH ';'
 		{
 			iface->mipv6.AdvMobRtrSupportFlag = $2;
diff -uNrwB radvd-2.16/includes.h radvd-2.17/includes.h
--- radvd-2.16/includes.h	2015-11-19 18:58:26.000000000 +0500
+++ radvd-2.17/includes.h	2017-06-29 09:32:02.000000000 +0500
@@ -16,19 +16,19 @@
 
 #include "config.h"
 
-#include <string.h>
-#include <stdio.h>
+#include <errno.h>
+#include <grp.h>
+#include <netdb.h>
+#include <pwd.h>
+#include <signal.h>
 #include <stdarg.h>
-#include <stdlib.h>
 #include <stdint.h>
-#include <time.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
 #include <syslog.h>
+#include <time.h>
 #include <unistd.h>
-#include <errno.h>
-#include <signal.h>
-#include <netdb.h>
-#include <pwd.h>
-#include <grp.h>
 
 #include <sys/types.h>
 #ifdef HAVE_INTTYPES_H
@@ -62,13 +62,13 @@
 #include <sys/time.h>
 #include <sys/uio.h>
 
-#include <sys/stat.h>
 #include <fcntl.h>
+#include <sys/stat.h>
 
 #include <netinet/in.h>
 
-#include <netinet/ip6.h>
 #include <netinet/icmp6.h>
+#include <netinet/ip6.h>
 
 #include <arpa/inet.h>
 
@@ -86,7 +86,7 @@
 #include <net/if_types.h>
 #endif
 
-#if defined(HAVE_NET_IF_ARP_H) && !defined(ARPHRD_ETHER)
+#if defined(HAVE_NET_IF_ARP_H) && !defined(ARPHRD_ETHER) && !defined(HAVE_LINUX_IF_ARP_H)
 #include <net/if_arp.h>
 #endif				/* defined(HAVE_NET_IF_ARP_H) && !defined(ARPHRD_ETHER) */
 
diff -uNrwB radvd-2.16/install-sh radvd-2.17/install-sh
--- radvd-2.16/install-sh	2017-02-01 14:06:17.000000000 +0500
+++ radvd-2.17/install-sh	2017-07-04 08:30:01.000000000 +0500
@@ -1,7 +1,7 @@
 #!/bin/sh
 # install - install a program, script, or datafile
 
-scriptversion=2013-12-25.23; # UTC
+scriptversion=2014-09-12.12; # UTC
 
 # This originates from X11R5 (mit/util/scripts/install.sh), which was
 # later released in X11R6 (xc/config/util/install.sh) with the
@@ -324,34 +324,41 @@
             # is incompatible with FreeBSD 'install' when (umask & 300) != 0.
             ;;
           *)
+            # $RANDOM is not portable (e.g. dash);  use it when possible to
+            # lower collision chance
             tmpdir=${TMPDIR-/tmp}/ins$RANDOM-$$
-            trap 'ret=$?; rmdir "$tmpdir/d" "$tmpdir" 2>/dev/null; exit $ret' 0
+            trap 'ret=$?; rmdir "$tmpdir/a/b" "$tmpdir/a" "$tmpdir" 2>/dev/null; exit $ret' 0
 
+            # As "mkdir -p" follows symlinks and we work in /tmp possibly;  so
+            # create the $tmpdir first (and fail if unsuccessful) to make sure
+            # that nobody tries to guess the $tmpdir name.
             if (umask $mkdir_umask &&
-                exec $mkdirprog $mkdir_mode -p -- "$tmpdir/d") >/dev/null 2>&1
+                $mkdirprog $mkdir_mode "$tmpdir" &&
+                exec $mkdirprog $mkdir_mode -p -- "$tmpdir/a/b") >/dev/null 2>&1
             then
               if test -z "$dir_arg" || {
                    # Check for POSIX incompatibilities with -m.
                    # HP-UX 11.23 and IRIX 6.5 mkdir -m -p sets group- or
                    # other-writable bit of parent directory when it shouldn't.
                    # FreeBSD 6.1 mkdir -m -p sets mode of existing directory.
-                   ls_ld_tmpdir=`ls -ld "$tmpdir"`
+                   test_tmpdir="$tmpdir/a"
+                   ls_ld_tmpdir=`ls -ld "$test_tmpdir"`
                    case $ls_ld_tmpdir in
                      d????-?r-*) different_mode=700;;
                      d????-?--*) different_mode=755;;
                      *) false;;
                    esac &&
-                   $mkdirprog -m$different_mode -p -- "$tmpdir" && {
-                     ls_ld_tmpdir_1=`ls -ld "$tmpdir"`
+                   $mkdirprog -m$different_mode -p -- "$test_tmpdir" && {
+                     ls_ld_tmpdir_1=`ls -ld "$test_tmpdir"`
                      test "$ls_ld_tmpdir" = "$ls_ld_tmpdir_1"
                    }
                  }
               then posix_mkdir=:
               fi
-              rmdir "$tmpdir/d" "$tmpdir"
+              rmdir "$tmpdir/a/b" "$tmpdir/a" "$tmpdir"
             else
               # Remove any dirs left behind by ancient mkdir implementations.
-              rmdir ./$mkdir_mode ./-p ./-- 2>/dev/null
+              rmdir ./$mkdir_mode ./-p ./-- "$tmpdir" 2>/dev/null
             fi
             trap '' 0;;
         esac;;
diff -uNrwB radvd-2.16/interface.c radvd-2.17/interface.c
--- radvd-2.16/interface.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/interface.c	2017-07-02 06:58:35.000000000 +0500
@@ -13,9 +13,9 @@
  */
 
 #include "config.h"
+#include "defaults.h"
 #include "includes.h"
 #include "radvd.h"
-#include "defaults.h"
 
 #define IFACE_SETUP_DELAY	1
 
@@ -31,6 +31,8 @@
 	iface->AdvSourceLLAddress = DFLT_AdvSourceLLAddress;
 	iface->MinDelayBetweenRAs = DFLT_MinDelayBetweenRAs;
 	iface->MinRtrAdvInterval = -1;
+	iface->UnicastOnly = DFLT_UnicastOnly;
+	iface->AdvRASolicitedUnicast = DFLT_AdvRASolicitedUnicast;
 
 	iface->ra_header_info.AdvDefaultPreference = DFLT_AdvDefaultPreference;
 	iface->ra_header_info.AdvDefaultLifetime = -1;
@@ -175,34 +175,31 @@
 	if (iface->MinRtrAdvInterval < 0)
 		iface->MinRtrAdvInterval = DFLT_MinRtrAdvInterval(iface);
 
-	if ((iface->MinRtrAdvInterval < (MIPv6 ? MIN_MinRtrAdvInterval_MIPv6 : MIN_MinRtrAdvInterval))
-	    || (iface->MinRtrAdvInterval > MAX_MinRtrAdvInterval(iface))) {
+	if ((iface->MinRtrAdvInterval < (MIPv6 ? MIN_MinRtrAdvInterval_MIPv6 : MIN_MinRtrAdvInterval)) ||
+	    (iface->MinRtrAdvInterval > MAX_MinRtrAdvInterval(iface))) {
 		flog(LOG_ERR,
 		     "MinRtrAdvInterval for %s (%.2f) must be at least %.2f but no more than 3/4 of MaxRtrAdvInterval (%.2f)",
-		     iface->props.name, iface->MinRtrAdvInterval, MIPv6 ? MIN_MinRtrAdvInterval_MIPv6 : (int)MIN_MinRtrAdvInterval,
-		     MAX_MinRtrAdvInterval(iface));
+		     iface->props.name, iface->MinRtrAdvInterval,
+		     MIPv6 ? MIN_MinRtrAdvInterval_MIPv6 : (int)MIN_MinRtrAdvInterval, MAX_MinRtrAdvInterval(iface));
 		res = -1;
 	}
 
-	if ((iface->MaxRtrAdvInterval < (MIPv6 ? MIN_MaxRtrAdvInterval_MIPv6 : MIN_MaxRtrAdvInterval))
-	    || (iface->MaxRtrAdvInterval > MAX_MaxRtrAdvInterval)) {
-		flog(LOG_ERR,
-		     "MaxRtrAdvInterval for %s (%.2f) must be between %.2f and %d",
-		     iface->props.name, iface->MaxRtrAdvInterval, MIPv6 ? MIN_MaxRtrAdvInterval_MIPv6 : (int)MIN_MaxRtrAdvInterval,
+	if ((iface->MaxRtrAdvInterval < (MIPv6 ? MIN_MaxRtrAdvInterval_MIPv6 : MIN_MaxRtrAdvInterval)) ||
+	    (iface->MaxRtrAdvInterval > MAX_MaxRtrAdvInterval)) {
+		flog(LOG_ERR, "MaxRtrAdvInterval for %s (%.2f) must be between %.2f and %d", iface->props.name,
+		     iface->MaxRtrAdvInterval, MIPv6 ? MIN_MaxRtrAdvInterval_MIPv6 : (int)MIN_MaxRtrAdvInterval,
 		     MAX_MaxRtrAdvInterval);
 		res = -1;
 	}
 
 	if (iface->MinDelayBetweenRAs < (MIPv6 ? MIN_DELAY_BETWEEN_RAS_MIPv6 : MIN_DELAY_BETWEEN_RAS)) {
-		flog(LOG_ERR,
-		     "MinDelayBetweenRAs for %s (%.2f) must be at least %.2f", iface->props.name, iface->MinDelayBetweenRAs,
-		     MIPv6 ? MIN_DELAY_BETWEEN_RAS_MIPv6 : MIN_DELAY_BETWEEN_RAS);
+		flog(LOG_ERR, "MinDelayBetweenRAs for %s (%.2f) must be at least %.2f", iface->props.name,
+		     iface->MinDelayBetweenRAs, MIPv6 ? MIN_DELAY_BETWEEN_RAS_MIPv6 : MIN_DELAY_BETWEEN_RAS);
 		res = -1;
 	}
 
-	if ((iface->AdvLinkMTU != 0)
-	    && ((iface->AdvLinkMTU < MIN_AdvLinkMTU)
-		|| (iface->sllao.if_maxmtu != -1 && (iface->AdvLinkMTU > iface->sllao.if_maxmtu)))) {
+	if ((iface->AdvLinkMTU != 0) && ((iface->AdvLinkMTU < MIN_AdvLinkMTU) ||
+					 (iface->sllao.if_maxmtu != -1 && (iface->AdvLinkMTU > iface->sllao.if_maxmtu)))) {
 		flog(LOG_ERR, "AdvLinkMTU for %s (%u) must be zero or between %u and %u", iface->props.name, iface->AdvLinkMTU,
 		     MIN_AdvLinkMTU, iface->sllao.if_maxmtu);
 		res = -1;
@@ -217,9 +214,9 @@
 	if (iface->ra_header_info.AdvDefaultLifetime < 0)
 		iface->ra_header_info.AdvDefaultLifetime = DFLT_AdvDefaultLifetime(iface);
 
-	if ((iface->ra_header_info.AdvDefaultLifetime != 0)
-	    && ((iface->ra_header_info.AdvDefaultLifetime > MAX_AdvDefaultLifetime)
-		|| (iface->ra_header_info.AdvDefaultLifetime < MIN_AdvDefaultLifetime(iface)))) {
+	if ((iface->ra_header_info.AdvDefaultLifetime != 0) &&
+	    ((iface->ra_header_info.AdvDefaultLifetime > MAX_AdvDefaultLifetime) ||
+	     (iface->ra_header_info.AdvDefaultLifetime < MIN_AdvDefaultLifetime(iface)))) {
 		flog(LOG_ERR, "AdvDefaultLifetime for %s (%u) must be zero or between %u and %u", iface->props.name,
 		     iface->ra_header_info.AdvDefaultLifetime, (int)MIN_AdvDefaultLifetime(iface), MAX_AdvDefaultLifetime);
 		res = -1;
@@ -231,9 +228,9 @@
 
 	/* Mobile IPv6 ext */
 	if (iface->mipv6.AdvHomeAgentInfo) {
-		if ((iface->mipv6.HomeAgentLifetime > MAX_HomeAgentLifetime) || (iface->mipv6.HomeAgentLifetime < MIN_HomeAgentLifetime)) {
-			flog(LOG_ERR,
-			     "HomeAgentLifetime for %s (%u) must be between %u and %u", iface->props.name,
+		if ((iface->mipv6.HomeAgentLifetime > MAX_HomeAgentLifetime) ||
+		    (iface->mipv6.HomeAgentLifetime < MIN_HomeAgentLifetime)) {
+			flog(LOG_ERR, "HomeAgentLifetime for %s (%u) must be between %u and %u", iface->props.name,
 			     iface->mipv6.HomeAgentLifetime, MIN_HomeAgentLifetime, MAX_HomeAgentLifetime);
 			res = -1;
 		}
@@ -258,7 +255,8 @@
 		}
 
 		if (prefix->AdvPreferredLifetime > prefix->AdvValidLifetime) {
-			flog(LOG_ERR, "AdvValidLifetime for %s (%u) must be " "greater than AdvPreferredLifetime for",
+			flog(LOG_ERR, "AdvValidLifetime for %s (%u) must be "
+				      "greater than AdvPreferredLifetime for",
 			     iface->props.name, prefix->AdvValidLifetime);
 			res = -1;
 		}
@@ -288,7 +286,9 @@
 			int route_zerolife = (route->AdvRouteLifetime == 0);
 			int defaultroute_zerolife = (iface->ra_header_info.AdvDefaultLifetime == 0);
 			if( route_zerolife ^ defaultroute_zerolife ) {
-				flog(LOG_ERR, "route 0::/0 lifetime (%u) conflicts with AdvDefaultLifetime (%u), default routes will flap!",
+				flog(
+				    LOG_ERR,
+				    "route 0::/0 lifetime (%u) conflicts with AdvDefaultLifetime (%u), default routes will flap!",
 						route->AdvRouteLifetime, iface->ra_header_info.AdvDefaultLifetime);
 				// res = -1; // In some future version, abort on this configuration error.
 			}
diff -uNrwB radvd-2.16/log.c radvd-2.17/log.c
--- radvd-2.16/log.c	2016-09-04 09:28:50.000000000 +0500
+++ radvd-2.17/log.c	2017-06-29 09:54:17.000000000 +0500
@@ -16,8 +16,7 @@
 #include "includes.h"
 #include "radvd.h"
 
-__attribute__ ((format(printf, 2, 0)))
-static int vlog(int prio, char const *format, va_list ap);
+__attribute__((format(printf, 2, 0))) static int vlog(int prio, char const *format, va_list ap);
 
 static int log_method = L_NONE;
 static char const *log_ident;
@@ -67,8 +66,7 @@
 }
 
 /* note: [dfv]log() is also called from root context */
-__attribute__ ((format(printf, 2, 0)))
-static int vlog(int prio, char const *format, va_list ap)
+__attribute__((format(printf, 2, 0))) static int vlog(int prio, char const *format, va_list ap)
 {
 	char tstamp[64], buff[1024];
 	struct tm *tm;
@@ -84,7 +82,7 @@
 		break;
 	case L_STDERR_SYSLOG:
 		syslog(prio, "%s", buff);
-		if (prio > LOG_ERR)	/* fall through for messages with high priority */
+		if (debug_level < prio) /* fall through for messages with high priority */
 			break;
 	case L_STDERR:
 		current = time(NULL);
@@ -155,12 +153,6 @@
 	return 0;
 }
 
-void set_debuglevel(int level)
-{
-	debug_level = level;
-}
+void set_debuglevel(int level) { debug_level = level; }
 
-int get_debuglevel(void)
-{
-	return debug_level;
-}
+int get_debuglevel(void) { return debug_level; }
diff -uNrwB radvd-2.16/Makefile.am radvd-2.17/Makefile.am
--- radvd-2.16/Makefile.am	2016-09-04 09:28:50.000000000 +0500
+++ radvd-2.17/Makefile.am	2017-06-29 09:32:02.000000000 +0500
@@ -140,7 +140,7 @@
 ### build support ###
 
 indent:
-	indent -linux -l125 *.c *.h
+	clang-format -i *.c *.h test/*.c test/*.h
 
 EXTRA_DIST = \
 	CHANGES \
diff -uNrwB radvd-2.16/Makefile.in radvd-2.17/Makefile.in
--- radvd-2.16/Makefile.in	2017-02-01 14:06:17.000000000 +0500
+++ radvd-2.17/Makefile.in	2017-07-04 08:30:01.000000000 +0500
@@ -584,6 +584,7 @@
 prefix = @prefix@
 program_transform_name = @program_transform_name@
 psdir = @psdir@
+runstatedir = @runstatedir@
 sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
@@ -1805,7 +1806,7 @@
 ### build support ###
 
 indent:
-	indent -linux -l125 *.c *.h
+	clang-format -i *.c *.h test/*.c test/*.h
 
 sign:
 	$(AM_V_GEN)for e in $(EXTENSIONS); do \
diff -uNrwB radvd-2.16/netlink.c radvd-2.17/netlink.c
--- radvd-2.16/netlink.c	2016-09-04 09:28:50.000000000 +0500
+++ radvd-2.17/netlink.c	2017-06-29 09:32:02.000000000 +0500
@@ -13,20 +13,20 @@
  *
  */
 
+#include "netlink.h"
 #include "config.h"
-#include "radvd.h"
 #include "log.h"
-#include "netlink.h"
+#include "radvd.h"
 
 #include <asm/types.h>
-#include <sys/socket.h>
+#include <errno.h>
 #include <linux/netlink.h>
 #include <linux/rtnetlink.h>
 #include <net/if.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <errno.h>
 #include <string.h>
+#include <sys/socket.h>
 
 #ifndef SOL_NETLINK
 #define SOL_NETLINK	270
@@ -175,12 +175,12 @@
 
 				if (count != iface->props.addrs_count ||
 					0 != memcmp(if_addrs, iface->props.if_addrs, count * sizeof(struct in6_addr))) {
-					dlog(LOG_DEBUG, 3, "netlink: %s, ifindex %d, addresses are different",
-						ifname, ifaddr->ifa_index);
+					dlog(LOG_DEBUG, 3, "netlink: %s, ifindex %d, addresses are different", ifname,
+					     ifaddr->ifa_index);
 					touch_iface(iface);
 				} else {
-					dlog(LOG_DEBUG, 3, "netlink: %s, ifindex %d, addresses are the same",
-						ifname, ifaddr->ifa_index);
+					dlog(LOG_DEBUG, 3, "netlink: %s, ifindex %d, addresses are the same", ifname,
+					     ifaddr->ifa_index);
 				}
 				free(if_addrs);
 			}
diff -uNrwB radvd-2.16/privsep-linux.c radvd-2.17/privsep-linux.c
--- radvd-2.16/privsep-linux.c	2015-11-19 18:58:27.000000000 +0500
+++ radvd-2.17/privsep-linux.c	2017-06-29 09:32:02.000000000 +0500
@@ -16,8 +16,8 @@
 
 #include "config.h"
 #include "includes.h"
-#include "radvd.h"
 #include "pathnames.h"
+#include "radvd.h"
 
 static int set_interface_var(const char *iface, const char *var, const char *name, uint32_t val);
 static void privsep_read_loop(void);
@@ -25,10 +25,7 @@
 /* For reading or writing, depending on process */
 static int pfd = -1;
 
-void privsep_set_write_fd(int fd)
-{
-	pfd = fd;
-}
+void privsep_set_write_fd(int fd) { pfd = fd; }
 
 /* Command types */
 enum privsep_type {
@@ -70,8 +67,8 @@
 
 		case SET_INTERFACE_LINKMTU:
 			if (cmd.val < MIN_AdvLinkMTU || cmd.val > MAX_AdvLinkMTU) {
-				flog(LOG_ERR, "(privsep) %s: LinkMTU (%u) is not within the defined bounds, ignoring",
-				     cmd.iface, cmd.val);
+				flog(LOG_ERR, "(privsep) %s: LinkMTU (%u) is not within the defined bounds, ignoring", cmd.iface,
+				     cmd.val);
 				break;
 			}
 			ret = set_interface_var(cmd.iface, PROC_SYS_IP6_LINKMTU, "LinkMTU", cmd.val);
@@ -88,13 +85,11 @@
 
 		case SET_INTERFACE_REACHTIME:
 			if (cmd.val < MIN_AdvReachableTime || cmd.val > MAX_AdvReachableTime) {
-				flog(LOG_ERR,
-				     "(privsep) %s: BaseReachableTimer (%u) is not within the defined bounds, ignoring",
+				flog(LOG_ERR, "(privsep) %s: BaseReachableTimer (%u) is not within the defined bounds, ignoring",
 				     cmd.iface, cmd.val);
 				break;
 			}
-			ret =
-			    set_interface_var(cmd.iface, PROC_SYS_IP6_BASEREACHTIME_MS, "BaseReachableTimer (ms)", cmd.val);
+			ret = set_interface_var(cmd.iface, PROC_SYS_IP6_BASEREACHTIME_MS, "BaseReachableTimer (ms)", cmd.val);
 			if (ret == 0)
 				break;
 			set_interface_var(cmd.iface, PROC_SYS_IP6_BASEREACHTIME, "BaseReachableTimer", cmd.val / 1000);
@@ -109,7 +104,8 @@
 			ret = set_interface_var(cmd.iface, PROC_SYS_IP6_RETRANSTIMER_MS, "RetransTimer (ms)", cmd.val);
 			if (ret == 0)
 				break;
-			set_interface_var(cmd.iface, PROC_SYS_IP6_RETRANSTIMER, "RetransTimer", cmd.val / 1000 * USER_HZ);	/* XXX user_hz */
+			set_interface_var(cmd.iface, PROC_SYS_IP6_RETRANSTIMER, "RetransTimer",
+					  cmd.val / 1000 * USER_HZ); /* XXX user_hz */
 			break;
 
 		default:
diff -uNrwB radvd-2.16/process.c radvd-2.17/process.c
--- radvd-2.16/process.c	2016-09-25 01:17:19.000000000 +0500
+++ radvd-2.17/process.c	2017-07-02 06:58:35.000000000 +0500
@@ -61,19 +61,22 @@
 
 	if (icmph->icmp6_type == ND_ROUTER_ADVERT) {
 		if (len < sizeof(struct nd_router_advert)) {
-			flog(LOG_WARNING, "%s received icmpv6 RA packet with invalid length (%d) from %s", if_name, len, addr_str);
+			flog(LOG_WARNING, "%s received icmpv6 RA packet with invalid length (%d) from %s", if_name, len,
+			     addr_str);
 			return;
 		}
 
 		if (!IN6_IS_ADDR_LINKLOCAL(&addr->sin6_addr)) {
-			flog(LOG_WARNING, "%s received icmpv6 RA packet with non-linklocal source address from %s", if_name, addr_str);
+			flog(LOG_WARNING, "%s received icmpv6 RA packet with non-linklocal source address from %s", if_name,
+			     addr_str);
 			return;
 		}
 	}
 
 	if (icmph->icmp6_type == ND_ROUTER_SOLICIT) {
 		if (len < sizeof(struct nd_router_solicit)) {
-			flog(LOG_WARNING, "%s received icmpv6 RS packet with invalid length (%d) from %s", if_name, len, addr_str);
+			flog(LOG_WARNING, "%s received icmpv6 RS packet with invalid length (%d) from %s", if_name, len,
+			     addr_str);
 			return;
 		}
 	}
@@ -94,8 +97,8 @@
 	}
 
 	if (!iface->state_info.ready && (0 != setup_iface(sock, iface))) {
-		flog(LOG_WARNING, "%s received RS or RA on %s but %s is not ready and setup_iface failed", if_name, iface->props.name,
-		     iface->props.name);
+		flog(LOG_WARNING, "%s received RS or RA on %s but %s is not ready and setup_iface failed", if_name,
+		     iface->props.name, iface->props.name);
 		return;
 	}
 
@@ -119,6 +122,34 @@
 
 static void process_rs(int sock, struct Interface *iface, unsigned char *msg, int len, struct sockaddr_in6 *addr)
 {
+	/* RFC 7772, section 5.1:
+	 * 5.1.  Network-Side Recommendations
+	 *    1.  Router manufacturers SHOULD allow network administrators to
+	 *        configure the routers to respond to Router Solicitations with
+	 *        unicast Router Advertisements if:
+	 *        *  The Router Solicitation's source address is not the
+	 *           unspecified address, and:
+	 *        *  The solicitation contains a valid Source Link-Layer Address
+	 *           option.
+	 *
+	 * However, testing shows that many clients do not set the SLLA option:
+	 * https://github.com/reubenhwk/radvd/issues/63#issuecomment-287172252
+	 * As of 2017/03/16:
+	 * - macOS 10.12.3 sierra - sends SLLA 2 times out of 4
+	 * - iOS 10.2.1 (iPhone 5s) - no SLLA
+	 * - Android 7.0 (sony xperia phone) - sends SLLA
+	 * - Android 5.1 (nexus 7 tablet) - sends SLLA
+	 * - Ubuntu 16.04.2 LTS w/ Network Manager, running 4.9 kernel (dell laptop) - no SLLA
+	 * - Windows 10 (dell laptop) - no SLLA
+	 *
+	 * We decide to ignore the SLLA option for now, and only require the
+	 * unspecified address check. Clients that did not set the SLLA option will
+	 * trigger a neighbour solicit to the solicited-node address trying to
+	 * resolve the link-local address to, this would still be less traffic than
+	 * the all-nodes multicast.
+	 */
+	int rfc7772_unicast_response = iface->AdvRASolicitedUnicast && !IN6_IS_ADDR_UNSPECIFIED(&addr->sin6_addr);
+
 	/* validation */
 	len -= sizeof(struct nd_router_solicit);
 
@@ -155,14 +186,12 @@
 
 	double const delay = (MAX_RA_DELAY_SECONDS * rand() / (RAND_MAX + 1.0));
 
-	if (iface->UnicastOnly) {
+	if (iface->UnicastOnly || rfc7772_unicast_response) {
 		send_ra_forall(sock, iface, &addr->sin6_addr);
 	} else if (timespecdiff(&ts, &iface->times.last_multicast) / 1000.0 < iface->MinDelayBetweenRAs) {
 		/* last RA was sent only a few moments ago, don't send another immediately. */
-		double next =
-		    iface->MinDelayBetweenRAs - (ts.tv_sec + ts.tv_nsec / 1000000000.0) + (iface->times.last_multicast.tv_sec +
-											iface->times.last_multicast.tv_nsec /
-											1000000000.0) + delay;
+		double next = iface->MinDelayBetweenRAs - (ts.tv_sec + ts.tv_nsec / 1000000000.0) +
+			      (iface->times.last_multicast.tv_sec + iface->times.last_multicast.tv_nsec / 1000000000.0) + delay;
 		dlog(LOG_DEBUG, 5, "%s: rate limiting RA's, rescheduling RA %f seconds from now", iface->props.name, next);
 		reschedule_iface(iface, next);
 	} else {
@@ -184,7 +213,8 @@
 
 	struct nd_router_advert *radvert = (struct nd_router_advert *)msg;
 
-	if ((radvert->nd_ra_curhoplimit && iface->ra_header_info.AdvCurHopLimit) && (radvert->nd_ra_curhoplimit != iface->ra_header_info.AdvCurHopLimit)) {
+	if ((radvert->nd_ra_curhoplimit && iface->ra_header_info.AdvCurHopLimit) &&
+	    (radvert->nd_ra_curhoplimit != iface->ra_header_info.AdvCurHopLimit)) {
 		flog(LOG_WARNING, "our AdvCurHopLimit on %s doesn't agree with %s", iface->props.name, addr_str);
 	}
 
@@ -198,13 +228,13 @@
 
 	/* note: we don't check the default router preference here, because they're likely different */
 
-	if ((radvert->nd_ra_reachable && iface->ra_header_info.AdvReachableTime)
-	    && (ntohl(radvert->nd_ra_reachable) != iface->ra_header_info.AdvReachableTime)) {
+	if ((radvert->nd_ra_reachable && iface->ra_header_info.AdvReachableTime) &&
+	    (ntohl(radvert->nd_ra_reachable) != iface->ra_header_info.AdvReachableTime)) {
 		flog(LOG_WARNING, "our AdvReachableTime on %s doesn't agree with %s", iface->props.name, addr_str);
 	}
 
-	if ((radvert->nd_ra_retransmit && iface->ra_header_info.AdvRetransTimer)
-	    && (ntohl(radvert->nd_ra_retransmit) != iface->ra_header_info.AdvRetransTimer)) {
+	if ((radvert->nd_ra_retransmit && iface->ra_header_info.AdvRetransTimer) &&
+	    (ntohl(radvert->nd_ra_retransmit) != iface->ra_header_info.AdvRetransTimer)) {
 		flog(LOG_WARNING, "our AdvRetransTimer on %s doesn't agree with %s", iface->props.name, addr_str);
 	}
 
@@ -228,8 +258,9 @@
 			flog(LOG_ERR, "zero length option in RA on %s from %s", iface->props.name, addr_str);
 			break;
 		} else if (optlen > len) {
-			flog(LOG_ERR, "option length (%d) greater than total" " length (%d) in RA on %s from %s", optlen,
-			     len, iface->props.name, addr_str);
+			flog(LOG_ERR, "option length (%d) greater than total"
+				      " length (%d) in RA on %s from %s",
+			     optlen, len, iface->props.name, addr_str);
 			break;
 		}
 
@@ -240,8 +271,7 @@
 					return;
 
 				if (iface->AdvLinkMTU && (ntohl(mtu->nd_opt_mtu_mtu) != iface->AdvLinkMTU)) {
-					flog(LOG_WARNING, "our AdvLinkMTU on %s doesn't agree with %s", iface->props.name,
-					     addr_str);
+				flog(LOG_WARNING, "our AdvLinkMTU on %s doesn't agree with %s", iface->props.name, addr_str);
 				}
 				break;
 			}
@@ -255,21 +285,19 @@
 				struct AdvPrefix *prefix = iface->AdvPrefixList;
 				while (prefix) {
 					char prefix_str[INET6_ADDRSTRLEN];
-					if ((prefix->PrefixLen == pinfo->nd_opt_pi_prefix_len)
-					    && addr_match(&prefix->Prefix, &pinfo->nd_opt_pi_prefix, prefix->PrefixLen)) {
+				if ((prefix->PrefixLen == pinfo->nd_opt_pi_prefix_len) &&
+				    addr_match(&prefix->Prefix, &pinfo->nd_opt_pi_prefix, prefix->PrefixLen)) {
 						addrtostr(&prefix->Prefix, prefix_str, sizeof(prefix_str));
 
 						if (!prefix->DecrementLifetimesFlag && valid != prefix->AdvValidLifetime) {
-							flog(LOG_WARNING,
-							     "our AdvValidLifetime on" " %s for %s doesn't agree with %s",
+						flog(LOG_WARNING, "our AdvValidLifetime on"
+								  " %s for %s doesn't agree with %s",
 							     iface->props.name, prefix_str, addr_str);
 						}
-						if (!prefix->DecrementLifetimesFlag
-						    && preferred != prefix->AdvPreferredLifetime) {
-							flog(LOG_WARNING,
-							     "our AdvPreferredLifetime on"
-							     " %s for %s doesn't agree with %s", iface->props.name, prefix_str,
-							     addr_str);
+					if (!prefix->DecrementLifetimesFlag && preferred != prefix->AdvPreferredLifetime) {
+						flog(LOG_WARNING, "our AdvPreferredLifetime on"
+								  " %s for %s doesn't agree with %s",
+						     iface->props.name, prefix_str, addr_str);
 						}
 					}
 
@@ -307,8 +335,7 @@
 					if (!check_rdnss_presence(rdnss, &rdnssinfo->nd_opt_rdnssi_addr3)) {
 						/* no match found in iface->AdvRDNSSList */
 						addrtostr(&rdnssinfo->nd_opt_rdnssi_addr3, rdnss_str, sizeof(rdnss_str));
-						flog(LOG_WARNING,
-						     "RDNSS address %s received on %s from %s is not advertised by us",
+					flog(LOG_WARNING, "RDNSS address %s received on %s from %s is not advertised by us",
 						     rdnss_str, iface->props.name, addr_str);
 					}
 					/* FALLTHROUGH */
@@ -317,8 +344,7 @@
 					if (!check_rdnss_presence(rdnss, &rdnssinfo->nd_opt_rdnssi_addr2)) {
 						/* no match found in iface->AdvRDNSSList */
 						addrtostr(&rdnssinfo->nd_opt_rdnssi_addr2, rdnss_str, sizeof(rdnss_str));
-						flog(LOG_WARNING,
-						     "RDNSS address %s received on %s from %s is not advertised by us",
+					flog(LOG_WARNING, "RDNSS address %s received on %s from %s is not advertised by us",
 						     rdnss_str, iface->props.name, addr_str);
 					}
 					/* FALLTHROUGH */
@@ -327,15 +353,13 @@
 					if (!check_rdnss_presence(rdnss, &rdnssinfo->nd_opt_rdnssi_addr1)) {
 						/* no match found in iface->AdvRDNSSList */
 						addrtostr(&rdnssinfo->nd_opt_rdnssi_addr1, rdnss_str, sizeof(rdnss_str));
-						flog(LOG_WARNING,
-						     "RDNSS address %s received on %s from %s is not advertised by us",
+					flog(LOG_WARNING, "RDNSS address %s received on %s from %s is not advertised by us",
 						     rdnss_str, iface->props.name, addr_str);
 					}
 
 					break;
 				default:
-					flog(LOG_ERR, "invalid len %i in RDNSS option on %s from %s", count, iface->props.name,
-					     addr_str);
+				flog(LOG_ERR, "invalid len %i in RDNSS option on %s from %s", count, iface->props.name, addr_str);
 				}
 
 				break;
@@ -361,8 +385,8 @@
 
 						if (!check_dnssl_presence(iface->AdvDNSSLList, suffix)) {
 							flog(LOG_WARNING,
-							     "DNSSL suffix %s received on %s from %s is not advertised by us",
-							     suffix, iface->props.name, addr_str);
+						     "DNSSL suffix %s received on %s from %s is not advertised by us", suffix,
+						     iface->props.name, addr_str);
 						}
 
 						suffix[0] = '\0';
@@ -373,10 +397,9 @@
 					 * 1) must not overflow int: label + 2, offset + label_len
 					 * 2) last byte of dnssli_suffix must not overflow opt_str + len
 					 */
-					if ((sizeof(suffix) - strlen(suffix)) < (label_len + 2) ||
-					    label_len >= (INT_MAX-1)
-					    || &dnsslinfo->nd_opt_dnssli_suffixes[offset + label_len] - opt_str >= len
-					    || offset + label_len < offset) {
+				if ((sizeof(suffix) - strlen(suffix)) < (label_len + 2) || label_len >= (INT_MAX - 1) ||
+				    &dnsslinfo->nd_opt_dnssli_suffixes[offset + label_len] - opt_str >= len ||
+				    offset + label_len < offset) {
 						flog(LOG_ERR, "oversized suffix in DNSSL option on %s from %s", iface->props.name,
 						     addr_str);
 						break;
diff -uNrwB radvd-2.16/radvd.c radvd-2.17/radvd.c
--- radvd-2.16/radvd.c	2016-09-04 09:28:50.000000000 +0500
+++ radvd-2.17/radvd.c	2017-07-02 07:04:20.000000000 +0500
@@ -13,22 +13,22 @@
  *
  */
 
+#include "radvd.h"
 #include "config.h"
 #include "includes.h"
-#include "radvd.h"
 #include "pathnames.h"
 
 #ifdef HAVE_NETLINK
 #include "netlink.h"
 #endif
 
+#include <libgen.h>
 #include <poll.h>
 #include <sys/file.h>
-#include <libgen.h>
 
 #ifdef HAVE_GETOPT_LONG
 
-/* *INDENT-OFF* */
+/* clang-format off */
 static char usage_str[] = {
 "\n"
 "  -C, --config=PATH       Set the config file.  Default is /etc/radvd.d.\n"
@@ -69,7 +69,7 @@
 "\t[-f facility] [-p pid_file] [-u username] [-t chrootdir]"
 
 };
-/* *INDENT-ON* */
+/* clang-format on */
 
 #endif
 
@@ -82,7 +82,7 @@
 static int drop_root_privileges(const char *);
 static int open_and_lock_pid_file(char const * daemon_pid_file_ident);
 static int write_pid_file(char const * daemon_pid_file_ident, pid_t pid);
-static pid_t daemonp(int nochdir, int noclose, char const * daemon_pid_file_ident);
+static pid_t daemonp(char const *daemon_pid_file_ident);
 static pid_t do_daemonize(int log_method, char const * daemon_pid_file_ident);
 static struct Interface * main_loop(int sock, struct Interface *ifaces, char const *conf_path);
 static struct Interface *reload_config(int sock, struct Interface *ifaces, char const *conf_path);
@@ -106,7 +106,7 @@
 /* daemonize and write pid file.  The pid of the daemon child process
  * will be written to the pid file from the *parent* process.  This
  * insures there is no race condition as described in redhat bug 664783. */
-static pid_t daemonp(int nochdir, int noclose, char const * daemon_pid_file_ident)
+static pid_t daemonp(char const *daemon_pid_file_ident)
 {
 	int pipe_ends[2];
 
@@ -138,13 +138,10 @@
 			exit(-1);
 		}
 
-		if (nochdir == 0) {
 			if (chdir("/") == -1) {
 				perror("chdir");
 				exit(1);
 			}
-		}
-		if (noclose == 0) {
 			close(STDIN_FILENO);
 			close(STDOUT_FILENO);
 			close(STDERR_FILENO);
@@ -160,7 +157,6 @@
 				flog(LOG_ERR, "unable to redirect stderr to /dev/null");
 				exit(-1);
 			}
-		}
 	} else {
 		/* Parent.  Make sure the pid file is written before exiting. */
 		close(pipe_ends[1]);
@@ -591,11 +586,7 @@
 {
 	pid_t pid = -1;
 
-	if (L_STDERR_SYSLOG == log_method || L_STDERR == log_method) {
-		pid = daemonp(1, 1, daemon_pid_file_ident);
-	} else {
-		pid = daemonp(0, 0, daemon_pid_file_ident);
-	}
+	pid = daemonp(daemon_pid_file_ident);
 
 	if (-1 == pid) {
 		flog(LOG_ERR, "unable to daemonize: %s", strerror(errno));
@@ -786,10 +776,7 @@
 	kickoff_adverts(sock, iface);
 }
 
-static void setup_ifaces(int sock, struct Interface *ifaces)
-{
-	for_each_iface(ifaces, setup_iface_foo, &sock);
-}
+static void setup_ifaces(int sock, struct Interface *ifaces) { for_each_iface(ifaces, setup_iface_foo, &sock); }
 
 static struct Interface *reload_config(int sock, struct Interface *ifaces, char const *conf_path)
 {
@@ -810,10 +797,7 @@
 	return ifaces;
 }
 
-static void sighup_handler(int sig)
-{
-	sighup_received = 1;
-}
+static void sighup_handler(int sig) { sighup_received = 1; }
 
 static void sigterm_handler(int sig)
 {
@@ -833,10 +817,7 @@
 	}
 }
 
-static void sigusr1_handler(int sig)
-{
-	sigusr1_received = 1;
-}
+static void sigusr1_handler(int sig) { sigusr1_received = 1; }
 
 static void reset_prefix_lifetimes_foo(struct Interface *iface, void *data)
 {
@@ -856,10 +837,7 @@
 	}
 }
 
-static void reset_prefix_lifetimes(struct Interface *ifaces)
-{
-	for_each_iface(ifaces, reset_prefix_lifetimes_foo, 0);
-}
+static void reset_prefix_lifetimes(struct Interface *ifaces) { for_each_iface(ifaces, reset_prefix_lifetimes_foo, 0); }
 
 static int drop_root_privileges(const char *username)
 {
@@ -904,8 +882,8 @@
 	}
 
 	/* for non-root: must not be writable by self/own group */
-	if (strncmp(username, "root", 5) != 0 && ((stbuf.st_mode & S_IWGRP && pw->pw_gid == stbuf.st_gid)
-						  || (stbuf.st_mode & S_IWUSR && pw->pw_uid == stbuf.st_uid))) {
+	if (strncmp(username, "root", 5) != 0 && ((stbuf.st_mode & S_IWGRP && pw->pw_gid == stbuf.st_gid) ||
+						  (stbuf.st_mode & S_IWUSR && pw->pw_uid == stbuf.st_uid))) {
 		flog(LOG_ERR, "Insecure file permissions (writable by self/group): %s", conf_file);
 		return -1;
 	}
diff -uNrwB radvd-2.16/radvd.conf.5.man radvd-2.17/radvd.conf.5.man
--- radvd-2.16/radvd.conf.5.man	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/radvd.conf.5.man	2017-07-02 06:58:35.000000000 +0500
@@ -93,7 +93,7 @@
 .B };
 .fi
 
-By default radvd will send route advertisements so that every node on the link can use them.
+By default radvd will send multicast route advertisements so that every node on the link can use them.
 The list of clients (IPv6 address) to advertise to, and accept route solicitations from can be configured.
 If done, radvd does not send send messages to the multicast addresses but
 to the configured unicast addresses only.  Solicitations from other addresses are refused.
@@ -173,6 +173,19 @@
 Default: off
 
 .TP
+.BR AdvRASolicitedUnicast " " on | off
+
+Indicates that router solicitations will be responded to with unicast
+router advertisements, as recommended by RFC7772. Large networks with a
+high concentration of mobile devices might experience like battery
+depletion, when solicited Router Advertisement messages are multicast.
+
+This corresponds to the Cisco IOS option
+.B ipv6 nd ra solicited unicast
+
+Default: on
+
+.TP
 .BR "MaxRtrAdvInterval " seconds
 
 The maximum time allowed between sending unsolicited multicast
diff -uNrwB radvd-2.16/radvd.conf.example radvd-2.17/radvd.conf.example
--- radvd-2.16/radvd.conf.example	2014-07-31 06:12:59.000000000 +0600
+++ radvd-2.17/radvd.conf.example	2017-06-29 09:46:52.000000000 +0500
@@ -8,7 +8,7 @@
 # NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE 
 #
 
-interface eth0
+interface lo
 {
 	AdvSendAdvert on;
 
diff -uNrwB radvd-2.16/radvd.h radvd-2.17/radvd.h
--- radvd-2.16/radvd.h	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/radvd.h	2017-07-02 06:58:35.000000000 +0500
@@ -16,8 +16,8 @@
 #pragma once
 
 #include "config.h"
-#include "includes.h"
 #include "defaults.h"
+#include "includes.h"
 #include "log.h"
 
 #define CONTACT_EMAIL	"Reuben Hawkins <reubenhwk@gmail.com>"
@@ -41,7 +41,8 @@
 	unsigned char * buffer;
 };
 
-#define SAFE_BUFFER_INIT (struct safe_buffer){.should_free = 0, .allocated = 0, .used = 0, .buffer = 0}
+#define SAFE_BUFFER_INIT                                                                                                         \
+	(struct safe_buffer) { .should_free = 0, .allocated = 0, .used = 0, .buffer = 0 }
 
 struct safe_buffer_list {
 	struct safe_buffer *sb;
@@ -58,6 +59,7 @@
 	double MinDelayBetweenRAs;
 	int AdvSourceLLAddress;
 	int UnicastOnly;
+	int AdvRASolicitedUnicast;
 	struct Clients *ClientList;
 
 	struct state_info {
@@ -288,9 +290,7 @@
 int setup_iface_addrs(struct Interface *);
 int update_device_index(struct Interface *iface);
 int update_device_info(int sock, struct Interface *);
-int get_iface_addrs(
-	char const *name,
-	struct in6_addr *if_addr, /* the first link local addr */
+int get_iface_addrs(char const *name, struct in6_addr *if_addr, /* the first link local addr */
 	struct in6_addr **if_addrs /* all the addrs */
 	);
 
diff -uNrwB radvd-2.16/radvdump.c radvd-2.17/radvdump.c
--- radvd-2.16/radvdump.c	2015-11-19 18:58:27.000000000 +0500
+++ radvd-2.17/radvdump.c	2017-06-29 09:32:02.000000000 +0500
@@ -13,21 +13,15 @@
  *
  */
 
+#include "radvd.h"
 #include "config.h"
 #include "includes.h"
-#include "radvd.h"
 
 static char usage_str[] = "[-vhfe] [-d level]";
 
 #ifdef HAVE_GETOPT_LONG
-struct option prog_opt[] = {
-	{"debug", 1, 0, 'd'},
-	{"file-format", 0, 0, 'f'},
-	{"exclude-defaults", 0, 0, 'e'},
-	{"version", 0, 0, 'v'},
-	{"help", 0, 0, 'h'},
-	{NULL, 0, 0, 0}
-};
+struct option prog_opt[] = {{"debug", 1, 0, 'd'},   {"file-format", 0, 0, 'f'}, {"exclude-defaults", 0, 0, 'e'},
+			    {"version", 0, 0, 'v'}, {"help", 0, 0, 'h'},	{NULL, 0, 0, 0}};
 #endif
 
 int sock = -1;
@@ -174,8 +168,7 @@
 		printf("\tAdvDefaultLifetime %hu;\n", ntohs(radvert->nd_ra_router_lifetime));
 
 	/* Mobile IPv6 ext */
-	if (!edefs
-	    || DFLT_AdvHomeAgentFlag != (ND_RA_FLAG_HOME_AGENT == (radvert->nd_ra_flags_reserved & ND_RA_FLAG_HOME_AGENT)))
+	if (!edefs || DFLT_AdvHomeAgentFlag != (ND_RA_FLAG_HOME_AGENT == (radvert->nd_ra_flags_reserved & ND_RA_FLAG_HOME_AGENT)))
 		printf("\tAdvHomeAgentFlag %s;\n", (radvert->nd_ra_flags_reserved & ND_RA_FLAG_HOME_AGENT) ? "on" : "off");
 
 	/* Route Preferences and more specific routes */
@@ -206,7 +199,8 @@
 			flog(LOG_ERR, "zero length option in RA");
 			break;
 		} else if (optlen > len) {
-			flog(LOG_ERR, "option length greater than total" " length in RA (type %d, optlen %d, len %d)",
+			flog(LOG_ERR, "option length greater than total"
+				      " length in RA (type %d, optlen %d, len %d)",
 			     (int)*opt_str, optlen, len);
 			break;
 		}
@@ -239,8 +233,7 @@
 				printf("\tAdvHomeAgentInfo on;\n");
 
 				/* NEMO ext */
-				if (!edefs
-				    || DFLT_AdvMobRtrSupportFlag != (ha_info->flags_reserved & ND_OPT_HAI_FLAG_SUPPORT_MR))
+			if (!edefs || DFLT_AdvMobRtrSupportFlag != (ha_info->flags_reserved & ND_OPT_HAI_FLAG_SUPPORT_MR))
 					printf("\tAdvMobRtrSupportFlag %s;\n",
 					       (ha_info->flags_reserved & ND_OPT_HAI_FLAG_SUPPORT_MR) ? "on" : "off");
 
@@ -293,7 +286,8 @@
 			flog(LOG_ERR, "zero length option in RA");
 			break;
 		} else if (optlen > orig_len) {
-			flog(LOG_ERR, "option length greater than total" " length in RA (type %d, optlen %d, len %d)",
+			flog(LOG_ERR, "option length greater than total"
+				      " length in RA (type %d, optlen %d, len %d)",
 			     (int)*opt_str, optlen, orig_len);
 			break;
 		}
@@ -318,26 +312,25 @@
 						printf("\t\tAdvPreferredLifetime infinity; # (0xffffffff)\n");
 				} else {
 					if (!edefs || DFLT_AdvPreferredLifetime != ntohl(pinfo->nd_opt_pi_preferred_time))
-						printf("\t\tAdvPreferredLifetime %u;\n",
-						       ntohl(pinfo->nd_opt_pi_preferred_time));
+					printf("\t\tAdvPreferredLifetime %u;\n", ntohl(pinfo->nd_opt_pi_preferred_time));
 				}
 
-				if (!edefs
-				    || DFLT_AdvOnLinkFlag != (ND_OPT_PI_FLAG_ONLINK ==
-							      (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_ONLINK)))
+			if (!edefs ||
+			    DFLT_AdvOnLinkFlag !=
+				(ND_OPT_PI_FLAG_ONLINK == (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_ONLINK)))
 					printf("\t\tAdvOnLink %s;\n",
 					       (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_ONLINK) ? "on" : "off");
 
-				if (!edefs
-				    || DFLT_AdvAutonomousFlag != (ND_OPT_PI_FLAG_AUTO ==
-								  (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_AUTO)))
+			if (!edefs ||
+			    DFLT_AdvAutonomousFlag !=
+				(ND_OPT_PI_FLAG_AUTO == (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_AUTO)))
 					printf("\t\tAdvAutonomous %s;\n",
 					       (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_AUTO) ? "on" : "off");
 
 				/* Mobile IPv6 ext */
-				if (!edefs
-				    || DFLT_AdvRouterAddr != (ND_OPT_PI_FLAG_RADDR ==
-							      (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_RADDR)))
+			if (!edefs ||
+			    DFLT_AdvRouterAddr !=
+				(ND_OPT_PI_FLAG_RADDR == (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_RADDR)))
 					printf("\t\tAdvRouterAddr %s;\n",
 					       (pinfo->nd_opt_pi_flags_reserved & ND_OPT_PI_FLAG_RADDR) ? "on" : "off");
 
@@ -358,8 +351,7 @@
 					printf("\n\troute %s/%d\n\t{\n", prefix_str, rinfo->nd_opt_ri_prefix_len);
 				}
 
-				if (!edefs
-				    || (((radvert->nd_ra_flags_reserved & 0x18) >> 3) & 0xff) != DFLT_AdvRoutePreference) {
+			if (!edefs || (((radvert->nd_ra_flags_reserved & 0x18) >> 3) & 0xff) != DFLT_AdvRoutePreference) {
 					printf("\t\tAdvRoutePreference ");
 					print_preferences(((rinfo->nd_opt_ri_flags_reserved & 0x18) >> 3) & 0xff);
 					printf(";\n");
diff -uNrwB radvd-2.16/recv.c radvd-2.17/recv.c
--- radvd-2.16/recv.c	2015-11-19 18:58:27.000000000 +0500
+++ radvd-2.17/recv.c	2017-06-29 09:32:02.000000000 +0500
@@ -17,7 +17,8 @@
 #include "includes.h"
 #include "radvd.h"
 
-int recv_rs_ra(int sock, unsigned char *msg, struct sockaddr_in6 *addr, struct in6_pktinfo **pkt_info, int *hoplimit, unsigned char * chdr)
+int recv_rs_ra(int sock, unsigned char *msg, struct sockaddr_in6 *addr, struct in6_pktinfo **pkt_info, int *hoplimit,
+	       unsigned char *chdr)
 {
 	struct iovec iov;
 	iov.iov_len = MSG_SIZE_RECV;
@@ -50,8 +51,8 @@
 		switch (cmsg->cmsg_type) {
 #ifdef IPV6_HOPLIMIT
 		case IPV6_HOPLIMIT:
-			if ((cmsg->cmsg_len == CMSG_LEN(sizeof(int))) && (*(int *)CMSG_DATA(cmsg) >= 0)
-			    && (*(int *)CMSG_DATA(cmsg) < 256)) {
+			if ((cmsg->cmsg_len == CMSG_LEN(sizeof(int))) && (*(int *)CMSG_DATA(cmsg) >= 0) &&
+			    (*(int *)CMSG_DATA(cmsg) < 256)) {
 				*hoplimit = *(int *)CMSG_DATA(cmsg);
 			} else {
 				flog(LOG_ERR, "received a bogus IPV6_HOPLIMIT from the kernel! len=%d, data=%d",
@@ -61,8 +62,8 @@
 			break;
 #endif				/* IPV6_HOPLIMIT */
 		case IPV6_PKTINFO:
-			if ((cmsg->cmsg_len == CMSG_LEN(sizeof(struct in6_pktinfo)))
-			    && ((struct in6_pktinfo *)CMSG_DATA(cmsg))->ipi6_ifindex) {
+			if ((cmsg->cmsg_len == CMSG_LEN(sizeof(struct in6_pktinfo))) &&
+			    ((struct in6_pktinfo *)CMSG_DATA(cmsg))->ipi6_ifindex) {
 				*pkt_info = (struct in6_pktinfo *)CMSG_DATA(cmsg);
 			} else {
 				flog(LOG_ERR, "received a bogus IPV6_PKTINFO from the kernel! len=%d, index=%d",
diff -uNrwB radvd-2.16/redhat/radvd.spec radvd-2.17/redhat/radvd.spec
--- radvd-2.16/redhat/radvd.spec	2017-02-01 14:06:21.000000000 +0500
+++ radvd-2.17/redhat/radvd.spec	2017-07-04 08:30:45.000000000 +0500
@@ -5,7 +5,7 @@
 
 Summary: A Router Advertisement daemon
 Name: radvd
-Version: 2.16
+Version: 2.17
 Release: 1
 # The code includes the advertising clause, so it's GPL-incompatible
 License: BSD with advertising
diff -uNrwB radvd-2.16/scanner.l radvd-2.17/scanner.l
--- radvd-2.16/scanner.l	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/scanner.l	2017-07-02 06:58:35.000000000 +0500
@@ -79,6 +79,7 @@
 AdvIntervalOpt		{ return T_AdvIntervalOpt; }
 AdvHomeAgentInfo	{ return T_AdvHomeAgentInfo; }
 UnicastOnly		{ return T_UnicastOnly; }
+AdvRASolicitedUnicast	{ return T_AdvRASolicitedUnicast; }
 
 Base6Interface		{ return T_Base6Interface; }
 Base6to4Interface	{ return T_Base6to4Interface; }
diff -uNrwB radvd-2.16/send.c radvd-2.17/send.c
--- radvd-2.16/send.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/send.c	2017-06-29 09:32:02.000000000 +0500
@@ -39,10 +39,15 @@
 static void add_ra_option_abro(struct safe_buffer * sb, struct AdvAbro const *abroo);
 
 // Options that generate 0 or more blocks
-static struct safe_buffer_list* add_ra_options_prefix(struct safe_buffer_list * sbl, struct Interface const * iface, char const * ifname, struct AdvPrefix const * prefix, int cease_adv, struct in6_addr const *dest);
-static struct safe_buffer_list* add_ra_options_route(struct safe_buffer_list * sbl, struct Interface const * iface, struct AdvRoute const *route, int cease_adv, struct in6_addr const *dest);
-static struct safe_buffer_list* add_ra_options_rdnss(struct safe_buffer_list * sbl, struct Interface const * iface, struct AdvRDNSS const *rdnss, int cease_adv, struct in6_addr const *dest);
-static struct safe_buffer_list* add_ra_options_dnssl(struct safe_buffer_list * sbl, struct Interface const * iface, struct AdvDNSSL const *dnssl, int cease_adv, struct in6_addr const *dest);
+static struct safe_buffer_list *add_ra_options_prefix(struct safe_buffer_list *sbl, struct Interface const *iface,
+						      char const *ifname, struct AdvPrefix const *prefix, int cease_adv,
+						      struct in6_addr const *dest);
+static struct safe_buffer_list *add_ra_options_route(struct safe_buffer_list *sbl, struct Interface const *iface,
+						     struct AdvRoute const *route, int cease_adv, struct in6_addr const *dest);
+static struct safe_buffer_list *add_ra_options_rdnss(struct safe_buffer_list *sbl, struct Interface const *iface,
+						     struct AdvRDNSS const *rdnss, int cease_adv, struct in6_addr const *dest);
+static struct safe_buffer_list *add_ra_options_dnssl(struct safe_buffer_list *sbl, struct Interface const *iface,
+						     struct AdvDNSSL const *dnssl, int cease_adv, struct in6_addr const *dest);
 
 // Scheduling of options per RFC7772
 static int schedule_helper(struct in6_addr const *dest, struct Interface const *iface, int option_lifetime);
@@ -167,7 +168,8 @@
 					if (prefix->curr_preferredlft == 0) {
 						char pfx_str[INET6_ADDRSTRLEN];
 						addrtostr(&prefix->Prefix, pfx_str, sizeof(pfx_str));
-						dlog(LOG_DEBUG, 3, "Will cease advertising %s/%u%%%s, preferred lifetime is 0", pfx_str, prefix->PrefixLen, iface->props.name);
+						dlog(LOG_DEBUG, 3, "Will cease advertising %s/%u%%%s, preferred lifetime is 0",
+						     pfx_str, prefix->PrefixLen, iface->props.name);
 					}
 				}
 			}
@@ -243,7 +244,9 @@
 	safe_buffer_append(sb, &pinfo, sizeof(pinfo));
 }
 
-static struct safe_buffer_list * add_auto_prefixes_6to4(struct safe_buffer_list * sbl, struct Interface const * iface, char const * ifname, struct AdvPrefix const *prefix, int cease_adv, struct in6_addr const *dest)
+static struct safe_buffer_list *add_auto_prefixes_6to4(struct safe_buffer_list *sbl, struct Interface const *iface,
+						       char const *ifname, struct AdvPrefix const *prefix, int cease_adv,
+						       struct in6_addr const *dest)
 {
 #ifdef HAVE_IFADDRS_H
 	struct AdvPrefix xprefix = *prefix;
@@ -257,8 +260,7 @@
 
 		char pfx_str[INET6_ADDRSTRLEN];
 		addrtostr(&xprefix.Prefix, pfx_str, sizeof(pfx_str));
-		dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s",
-			pfx_str, xprefix.PrefixLen, ifname);
+		dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s", pfx_str, xprefix.PrefixLen, ifname);
 
 		/* TODO: Something must be done with these. */
 		(void)xprefix.curr_validlft;
@@ -273,8 +275,8 @@
 	return sbl;
 }
 
-
-static struct safe_buffer_list * add_auto_prefixes(struct safe_buffer_list * sbl, struct Interface const * iface, char const * ifname, struct AdvPrefix const *prefix, int cease_adv, struct in6_addr const *dest)
+static struct safe_buffer_list *add_auto_prefixes(struct safe_buffer_list *sbl, struct Interface const *iface, char const *ifname,
+						  struct AdvPrefix const *prefix, int cease_adv, struct in6_addr const *dest)
 {
 #ifdef HAVE_IFADDRS_H
 	struct AdvPrefix xprefix;
@@ -303,8 +305,7 @@
 
 		char pfx_str[INET6_ADDRSTRLEN];
 		addrtostr(&xprefix.Prefix, pfx_str, sizeof(pfx_str));
-		dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s",
-			pfx_str, xprefix.PrefixLen, ifname);
+		dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s", pfx_str, xprefix.PrefixLen, ifname);
 
 		/* TODO: Something must be done with these. */
 		(void)xprefix.curr_validlft;
@@ -322,7 +323,9 @@
 	return sbl;
 }
 
-static struct safe_buffer_list* add_ra_options_prefix(struct safe_buffer_list * sbl, struct Interface const * iface, char const * ifname, struct AdvPrefix const *prefix, int cease_adv, struct in6_addr const *dest)
+static struct safe_buffer_list *add_ra_options_prefix(struct safe_buffer_list *sbl, struct Interface const *iface,
+						      char const *ifname, struct AdvPrefix const *prefix, int cease_adv,
+						      struct in6_addr const *dest)
 {
 	while (prefix) {
 		if ((!prefix->DecrementLifetimesFlag || prefix->curr_preferredlft > 0)) {
@@ -353,9 +356,7 @@
 	return sbl;
 }
 
-
-
-/* *INDENT-OFF* */
+/* clang-format off */
 /*
  * Domain Names of DNS Search List
  *   One or more domain names of DNS Search List that MUST
@@ -374,7 +375,7 @@
  *   encoding parts of the domain name representations
  *   MUST be padded with zeros.
  */
-/* *INDENT-ON* */
+/* clang-format on */
 static size_t serialize_domain_names(struct safe_buffer * safe_buffer, struct AdvDNSSL const *dnssl)
 {
 	size_t len = 0;
@@ -410,7 +411,8 @@
 	return len;
 }
 
-static struct safe_buffer_list* add_ra_options_route(struct safe_buffer_list *sbl, struct Interface const * iface, struct AdvRoute const *route, int cease_adv, struct in6_addr const *dest)
+static struct safe_buffer_list *add_ra_options_route(struct safe_buffer_list *sbl, struct Interface const *iface,
+						     struct AdvRoute const *route, int cease_adv, struct in6_addr const *dest)
 {
 	while (route) {
 		struct nd_opt_route_info_local rinfo;
@@ -444,7 +446,8 @@
 	return sbl;
 }
 
-static struct safe_buffer_list * add_ra_options_rdnss(struct safe_buffer_list * sbl, struct Interface const * iface, struct AdvRDNSS const *rdnss, int cease_adv, struct in6_addr const *dest)
+static struct safe_buffer_list *add_ra_options_rdnss(struct safe_buffer_list *sbl, struct Interface const *iface,
+						     struct AdvRDNSS const *rdnss, int cease_adv, struct in6_addr const *dest)
 {
 	while (rdnss) {
 		struct nd_opt_rdnss_info_local rdnssinfo;
@@ -471,7 +474,8 @@
 		memcpy(&rdnssinfo.nd_opt_rdnssi_addr3, &rdnss->AdvRDNSSAddr3, sizeof(struct in6_addr));
 
 		sbl = safe_buffer_list_append(sbl);
-		safe_buffer_append(sbl->sb, &rdnssinfo, sizeof(rdnssinfo) - (3 - rdnss->AdvRDNSSNumber) * sizeof(struct in6_addr));
+		safe_buffer_append(sbl->sb, &rdnssinfo,
+				   sizeof(rdnssinfo) - (3 - rdnss->AdvRDNSSNumber) * sizeof(struct in6_addr));
 
 		rdnss = rdnss->next;
 	}
@@ -479,67 +483,12 @@
 	return sbl;
 }
 
-static struct safe_buffer_list * add_ra_options_dnssl(struct safe_buffer_list * sbl, struct Interface const * iface, struct AdvDNSSL const *dnssl, int cease_adv, struct in6_addr const *dest)
+static struct safe_buffer_list *add_ra_options_dnssl(struct safe_buffer_list *sbl, struct Interface const *iface,
+						     struct AdvDNSSL const *dnssl, int cease_adv, struct in6_addr const *dest)
 {
 	struct safe_buffer *serialized_domains = new_safe_buffer();
 	while (dnssl) {
 
-		/* *INDENT-OFF* */
-		/*
-		 * Snippet from RFC 6106...
-		 *
-		 *    5.2. DNS Search List Option
-		 * 
-		 * 
-		 *    The DNSSL option contains one or more domain names of DNS suffixes.
-		 *    All of the domain names share the same Lifetime value.  If it is
-		 *    desirable to have different Lifetime values, multiple DNSSL options
-		 *    can be used.  Figure 2 shows the format of the DNSSL option.
-		 * 
-		 *       0                   1                   2                   3
-		 *       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
-		 *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-		 *      |     Type      |     Length    |           Reserved            |
-		 *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-		 *      |                           Lifetime                            |
-		 *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-		 *      |                                                               |
-		 *      :                Domain Names of DNS Search List                :
-		 *      |                                                               |
-		 *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-		 * 
-		 *               Figure 2: DNS Search List (DNSSL) Option Format
-		 * 
-		 *   Fields:
-		 *     Type          8-bit identifier of the DNSSL option type as assigned
-		 *                   by the IANA: 31
-		 * 
-		 *     Length        8-bit unsigned integer.  The length of the option
-		 *                   (including the Type and Length fields) is in units of
-		 *                   8 octets.  The minimum value is 2 if at least one
-		 *                   domain name is contained in the option.  The Length
-		 *                   field is set to a multiple of 8 octets to accommodate
-		 *                   all the domain names in the field of Domain Names of
-		 *                   DNS Search List.
-		 * 
-		 *     Lifetime      32-bit unsigned integer.  The maximum time, in
-		 *                   seconds (relative to the time the packet is sent),
-		 *                   over which this DNSSL domain name MAY be used for
-		 *                   name resolution.  The Lifetime value has the same
-		 *                   semantics as with the RDNSS option.  That is, Lifetime
-		 *                   SHOULD be bounded as follows:
-		 *                   MaxRtrAdvInterval <= Lifetime <= 2*MaxRtrAdvInterval.
-		 *                   A value of all one bits (0xffffffff) represents
-		 *                   infinity.  A value of zero means that the DNSSL
-		 *                   domain name MUST no longer be used.
-		 * 
-		 *     Domain Names of DNS Search List
-		 *                   One or more domain names of DNS Search List that MUST
-		 *                   be encoded using the technique described in Section
-		 *                   3.1 of [RFC1035].
-		 * 
-		 */
-		/* *INDENT-ON* */
 		struct nd_opt_dnssl_info_local dnsslinfo;
 
 		if(!cease_adv && !schedule_option_dnssl(dest, iface, dnssl)) {
@@ -588,39 +536,6 @@
  */
 static void add_ra_option_sllao(struct safe_buffer * sb, struct sllao const *sllao)
 {
-	/* *INDENT-OFF* */
-	/*
-	4.6.1.  Source/Target Link-layer Address
-
-	      0                   1                   2                   3
-	      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
-	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-	     |     Type      |    Length     |    Link-Layer Address ...
-	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-
-	   Fields:
-
-	      Type
-			     1 for Source Link-layer Address
-			     2 for Target Link-layer Address
-
-	      Length         The length of the option (including the type and
-			     length fields) in units of 8 octets.  For example,
-			     the length for IEEE 802 addresses is 1 [IPv6-
-			     ETHER].
-
-	      Link-Layer Address
-			     The variable length link-layer address.
-
-			     The content and format of this field (including
-			     byte and bit ordering) is expected to be specified
-			     in specific documents that describe how IPv6
-			     operates over different link layers.  For instance,
-			     [IPv6-ETHER].
-
-	 */
-	/* *INDENT-ON* */
-
 	/* +2 for the ND_OPT_SOURCE_LINKADDR and the length (each occupy one byte) */
 	size_t const sllao_bytes = (sllao->if_hwaddr_len / 8) + 2;
 	size_t const sllao_len = (sllao_bytes + 7) / 8;
@@ -735,7 +649,8 @@
 	struct safe_buffer_list *cur = sbl;
 
 	if (iface->AdvPrefixList) {
-		cur = add_ra_options_prefix(cur, iface, iface->props.name, iface->AdvPrefixList, iface->state_info.cease_adv, dest);
+		cur =
+		    add_ra_options_prefix(cur, iface, iface->props.name, iface->AdvPrefixList, iface->state_info.cease_adv, dest);
 	}
 
 	if (iface->AdvRouteList) {
@@ -768,9 +683,9 @@
 		add_ra_option_mipv6_rtr_adv_interval(cur->sb, iface->MaxRtrAdvInterval);
 	}
 
-	if (iface->mipv6.AdvHomeAgentInfo && schedule_option_mipv6_home_agent_info(dest, iface)
-	    && (iface->mipv6.AdvMobRtrSupportFlag || iface->mipv6.HomeAgentPreference != 0
-		|| iface->mipv6.HomeAgentLifetime != iface->ra_header_info.AdvDefaultLifetime)) {
+	if (iface->mipv6.AdvHomeAgentInfo && schedule_option_mipv6_home_agent_info(dest, iface) &&
+	    (iface->mipv6.AdvMobRtrSupportFlag || iface->mipv6.HomeAgentPreference != 0 ||
+	     iface->mipv6.HomeAgentLifetime != iface->ra_header_info.AdvDefaultLifetime)) {
 		cur->next = new_safe_buffer_list();
 		cur = cur->next;
 		add_ra_option_mipv6_home_agent_info(cur->sb, &iface->mipv6);
@@ -818,32 +733,6 @@
 	// Build RA option list
 	struct safe_buffer_list *ra_opts = build_ra_options(iface, dest);
 
-	/* *INDENT-OFF* */
-	/*
-	 *	RFC4861: 6.2.3.  Router Advertisement Message Content
-	 *	   If including all options causes the size of an advertisement to
-	 *	   exceed the link MTU, multiple advertisements can be sent, each
-	 *	   containing a subset of the options.
-	 *
-	 *	RFC6980: 5.  Specification
-	 *		Nodes MUST NOT employ IPv6 fragmentation for sending any of the
-	 *		following Neighbor Discovery and SEcure Neighbor Discovery messages:
-	 *
-	 *		o  Neighbor Solicitation
-	 *		o  Neighbor Advertisement
-	 *		o  Router Solicitation
-	 *		o  Router Advertisement
-	 *		o  Redirect
-	 *		o  Certification Path Solicitation
-	 *
-	 *		Nodes SHOULD NOT employ IPv6 fragmentation for sending the following
-	 *		messages (see Section 6.4.2 of [RFC3971]):
-	 *
-	 *		o  Certification Path Advertisement
-	 *
-	*/
-	/* *INDENT-ON* */
-
 	// Send out one or more RAs, all in the form of (hdr+options),
 	// such that none of the RAs exceed the link MTU
 	// (max size is pre-computed in iface->props.max_ra_option_size)
@@ -902,12 +791,14 @@
 			// send ONE RA out, so that clients get the RA header fields.
 		} else if(option_count == 0 && total_seen_options > 0) {
 			// None of the RA options are scheduled for this window.
-			dlog(LOG_DEBUG, 5, "No RA options scheduled in this pass, staying quiet; already sent at least one RA packet");
+			dlog(LOG_DEBUG, 5,
+			     "No RA options scheduled in this pass, staying quiet; already sent at least one RA packet");
 			break;
 		}
 
 		// RA built, now send it.
-		dlog(LOG_DEBUG, 5, "sending RA to %s on %s (%s), %lu options (using %lu/%u bytes)", dest_text, iface->props.name, src_text, option_count, sb->used, iface->props.max_ra_option_size);
+		dlog(LOG_DEBUG, 5, "sending RA to %s on %s (%s), %lu options (using %lu/%u bytes)", dest_text, iface->props.name,
+		     src_text, option_count, sb->used, iface->props.max_ra_option_size);
 		int err = really_send(sock, dest, &iface->props, sb);
 		if (err < 0) {
 			if (!iface->IgnoreIfMissing || !(errno == EINVAL || errno == ENODEV))
diff -uNrwB radvd-2.16/test/check.c radvd-2.17/test/check.c
--- radvd-2.16/test/check.c	2015-11-19 18:58:27.000000000 +0500
+++ radvd-2.17/test/check.c	2017-06-29 09:32:02.000000000 +0500
@@ -2,10 +2,10 @@
 #include "config.h"
 
 #include <check.h>
-#include <stdlib.h>
 #include <stdio.h>
-#include <unistd.h>
+#include <stdlib.h>
 #include <time.h>
+#include <unistd.h>
 
 #ifdef HAVE_GETOPT_H
 #include <getopt.h>
@@ -19,7 +18,7 @@
 
 #ifdef HAVE_GETOPT_LONG
 
-/* *INDENT-OFF* */
+/* clang-format off */
 static char usage_str[] = {
 "\n"
 "  -h, --help                Print the help and quit.\n"
@@ -43,7 +42,7 @@
 static char usage_str[] = {
 "[-hv] [-m mode] [-s suite] [-t test]"
 };
-/* *INDENT-ON* */
+/* clang-format on */
 
 #endif
 
@@ -74,20 +73,15 @@
 		case 'm':
 			if (0 == strcmp(optarg, "SILENT")){
 				mode = CK_SILENT;
-			}
-			else if (0 == strcmp(optarg, "MINIMAL")){
+			} else if (0 == strcmp(optarg, "MINIMAL")) {
 				mode = CK_MINIMAL;
-			}
-			else if (0 == strcmp(optarg, "NORMAL")){
+			} else if (0 == strcmp(optarg, "NORMAL")) {
 				mode = CK_NORMAL;
-			}
-			else if (0 == strcmp(optarg, "VERBOSE")){
+			} else if (0 == strcmp(optarg, "VERBOSE")) {
 				mode = CK_VERBOSE;
-			}
-			else if (0 == strcmp(optarg, "ENV")){
+			} else if (0 == strcmp(optarg, "ENV")) {
 				mode = CK_ENV;
-			}
-			else {
+			} else {
 				fprintf(stderr, "%s: mode, \"%s\", unknown.\n", pname, optarg);
 				exit(1);
 			}
diff -uNrwB radvd-2.16/test/print_safe_buffer.c radvd-2.17/test/print_safe_buffer.c
--- radvd-2.16/test/print_safe_buffer.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/test/print_safe_buffer.c	2017-06-29 09:32:02.000000000 +0500
@@ -1,7 +1,7 @@
 
+#include "print_safe_buffer.h"
 #include "../config.h"
 #include "../radvd.h"
-#include "print_safe_buffer.h"
 
 #include <stdio.h>
 
diff -uNrwB radvd-2.16/test/send.c radvd-2.17/test/send.c
--- radvd-2.16/test/send.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/test/send.c	2017-06-29 09:32:02.000000000 +0500
@@ -1,6 +1,6 @@
 
-#include <check.h>
 #include "test/print_safe_buffer.h"
+#include <check.h>
 
 /*
  * http://check.sourceforge.net/doc/check_html/check_3.html
@@ -46,8 +46,7 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x86, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x86, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 	};
 
 	ck_assert_int_eq(sizeof(expected), sb.used);
@@ -76,18 +75,12 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x03, 0x04, 0x40, 0xe0, 0xff, 0xff, 0xff, 0xff,
-		0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00,
-		0xfe, 0x80, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x03, 0x04, 0x30, 0x80, 0x00, 0x00, 0x27, 0x10,
-		0x00, 0x00, 0x03, 0xe8, 0x00, 0x00, 0x00, 0x00,
-		0xfe, 0x80, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x03, 0x04, 0x40, 0xc0, 0x00, 0x01, 0x51, 0x80,
-		0x00, 0x00, 0x38, 0x40, 0x00, 0x00, 0x00, 0x00,
-		0xfe, 0x80, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x03, 0x04, 0x40, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00,
+	    0xfe, 0x80, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x03, 0x04, 0x30, 0x80, 0x00, 0x00, 0x27, 0x10, 0x00, 0x00, 0x03, 0xe8, 0x00, 0x00, 0x00, 0x00,
+	    0xfe, 0x80, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x03, 0x04, 0x40, 0xc0, 0x00, 0x01, 0x51, 0x80, 0x00, 0x00, 0x38, 0x40, 0x00, 0x00, 0x00, 0x00,
+	    0xfe, 0x80, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 	};
 
 	ck_assert_int_eq(sizeof(expected), sb.used);
@@ -116,15 +109,10 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x18, 0x03, 0x30, 0x18, 0x00, 0x00, 0x27, 0x10,
-		0xfe, 0x80, 0x00, 0x0f, 0x00, 0x01, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x18, 0x03, 0x28, 0x08, 0xff, 0xff, 0xff, 0xff,
-		0xfe, 0x80, 0x00, 0x0f, 0x00, 0x02, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x18, 0x03, 0x20, 0x00, 0x00, 0x00, 0x0b, 0xb8,
-		0xfe, 0x80, 0x00, 0x0f, 0x00, 0x02, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x18, 0x03, 0x30, 0x18, 0x00, 0x00, 0x27, 0x10, 0xfe, 0x80, 0x00, 0x0f, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
+	    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x03, 0x28, 0x08, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x80, 0x00, 0x0f,
+	    0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x03, 0x20, 0x00, 0x00, 0x00,
+	    0x0b, 0xb8, 0xfe, 0x80, 0x00, 0x0f, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 	};
 
 	ck_assert_int_eq(sizeof(expected), sb.used);
@@ -153,13 +140,9 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x19, 0x07, 0x00, 0x00, 0x00, 0x00, 0x04, 0xd2,
-		0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
-		0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
-		0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
+	    0x19, 0x07, 0x00, 0x00, 0x00, 0x00, 0x04, 0xd2, 0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x00, 0x02, 0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
 	};
 
 	ck_assert_int_eq(sizeof(expected), sb.used);
@@ -192,9 +174,8 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x19, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d,
-		0x12, 0x34, 0x04, 0x23, 0xfe, 0xfe, 0x04, 0x93,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
+	    0x19, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x12, 0x34, 0x04, 0x23,
+	    0xfe, 0xfe, 0x04, 0x93, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
 	};
 
 	ck_assert_int_eq(sizeof(expected), sb.used);
@@ -224,31 +204,17 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x1f, 0x09, 0x00, 0x00, 0x00, 0x00, 0x03, 0xe8,
-		0x06, 0x6f, 0x66, 0x66, 0x69, 0x63, 0x65, 0x06,
-		0x62, 0x72, 0x61, 0x6e, 0x63, 0x68, 0x07, 0x65,
-		0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03, 0x63,
-		0x6f, 0x6d, 0x00, 0x06, 0x62, 0x72, 0x61, 0x6e,
-		0x63, 0x68, 0x07, 0x65, 0x78, 0x61, 0x6d, 0x70,
-		0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00, 0x07,
-		0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03,
-		0x63, 0x6f, 0x6d, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x1f, 0x09, 0x00, 0x00, 0x00, 0x00, 0x04, 0x4b,
-		0x06, 0x6f, 0x66, 0x66, 0x69, 0x63, 0x65, 0x06,
-		0x62, 0x72, 0x61, 0x6e, 0x63, 0x68, 0x07, 0x65,
-		0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03, 0x6e,
-		0x65, 0x74, 0x00, 0x06, 0x62, 0x72, 0x61, 0x6e,
-		0x63, 0x68, 0x07, 0x65, 0x78, 0x61, 0x6d, 0x70,
-		0x6c, 0x65, 0x03, 0x6e, 0x65, 0x74, 0x00, 0x07,
-		0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03,
-		0x6e, 0x65, 0x74, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x1f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x04, 0x4c,
-		0x06, 0x6f, 0x66, 0x66, 0x69, 0x63, 0x65, 0x06,
-		0x62, 0x72, 0x61, 0x6e, 0x63, 0x68, 0x07, 0x65,
-		0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x00, 0x06,
-		0x62, 0x72, 0x61, 0x6e, 0x63, 0x68, 0x07, 0x65,
-		0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x00, 0x07,
-		0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x00,
+	    0x1f, 0x09, 0x00, 0x00, 0x00, 0x00, 0x03, 0xe8, 0x06, 0x6f, 0x66, 0x66, 0x69, 0x63, 0x65, 0x06, 0x62, 0x72, 0x61,
+	    0x6e, 0x63, 0x68, 0x07, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00, 0x06, 0x62, 0x72,
+	    0x61, 0x6e, 0x63, 0x68, 0x07, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00, 0x07, 0x65,
+	    0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x09, 0x00, 0x00,
+	    0x00, 0x00, 0x04, 0x4b, 0x06, 0x6f, 0x66, 0x66, 0x69, 0x63, 0x65, 0x06, 0x62, 0x72, 0x61, 0x6e, 0x63, 0x68, 0x07,
+	    0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03, 0x6e, 0x65, 0x74, 0x00, 0x06, 0x62, 0x72, 0x61, 0x6e, 0x63, 0x68,
+	    0x07, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x03, 0x6e, 0x65, 0x74, 0x00, 0x07, 0x65, 0x78, 0x61, 0x6d, 0x70,
+	    0x6c, 0x65, 0x03, 0x6e, 0x65, 0x74, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x04, 0x4c,
+	    0x06, 0x6f, 0x66, 0x66, 0x69, 0x63, 0x65, 0x06, 0x62, 0x72, 0x61, 0x6e, 0x63, 0x68, 0x07, 0x65, 0x78, 0x61, 0x6d,
+	    0x70, 0x6c, 0x65, 0x00, 0x06, 0x62, 0x72, 0x61, 0x6e, 0x63, 0x68, 0x07, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65,
+	    0x00, 0x07, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x00,
 	};
 
 	ck_assert_int_eq(sizeof(expected), sb.used);
@@ -287,10 +252,7 @@
 START_TEST (test_add_ra_option_sllao)
 {
 	struct sllao sllao48 = {
-		{1, 2, 3, 4, 5, 6, 7, 8},
-		48,
-		64,
-		1500,
+	    {1, 2, 3, 4, 5, 6, 7, 8}, 48, 64, 1500,
 	};
 	
 	struct safe_buffer sb = SAFE_BUFFER_INIT;
@@ -312,10 +274,7 @@
 	safe_buffer_free(&sb);
 
 	struct sllao sllao64 = {
-		{1, 2, 3, 4, 5, 6, 7, 8},
-		64,
-		64,
-		1500,
+	    {1, 2, 3, 4, 5, 6, 7, 8}, 64, 64, 1500,
 	};
 	
 	sb = SAFE_BUFFER_INIT;
@@ -326,8 +285,7 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected64[] = {
-		0x01, 0x02, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
-		0x07, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x01, 0x02, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 	};
 
 	ck_assert_int_eq(sizeof(expected64), sb.used);
@@ -351,9 +309,8 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x22, 0x03, 0x32, 0x48, 0x00, 0x00, 0xe8, 0x03,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+	    0x22, 0x03, 0x32, 0x48, 0x00, 0x00, 0xe8, 0x03, 0x00, 0x00, 0x00, 0x00,
+	    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 	};
 
 	ck_assert_int_eq(sb.used, sizeof(expected));
@@ -378,9 +334,8 @@
 	ck_assert_msg(0, "\n%s", &buf);
 #else
 	unsigned char expected[] = {
-		0x23, 0x03, 0x0a, 0x00, 0x02, 0x00, 0x02, 0x00,
-		0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-		0xa2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
+	    0x23, 0x03, 0x0a, 0x00, 0x02, 0x00, 0x02, 0x00, 0xfe, 0x80, 0x00, 0x00,
+	    0x00, 0x00, 0x00, 0x00, 0xa2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
 	};
 
 	ck_assert_int_eq(sb.used, sizeof(expected));
diff -uNrwB radvd-2.16/test/util.c radvd-2.17/test/util.c
--- radvd-2.16/test/util.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/test/util.c	2017-06-29 09:32:02.000000000 +0500
@@ -111,10 +111,7 @@
 	char buffer[INET6_ADDRSTRLEN] = {""};
 	struct in6_addr addr = {
 		{
-			0xfe, 0x80, 0xfe, 0x80,
-			0x00, 0x00, 0x00, 0x00,
-			0x00, 0x00, 0x00, 0x00,
-			0xff, 0x00, 0x12, 0x34,
+		0xfe, 0x80, 0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x12, 0x34,
 		},
 	};
 	addrtostr(&addr, buffer, sizeof(buffer));
@@ -127,10 +124,7 @@
 	char buffer[18] = {""};
 	struct in6_addr addr = {
 		{
-			0xfe, 0x80, 0xfe, 0x80,
-			0x00, 0x00, 0x00, 0x00,
-			0x00, 0x00, 0x00, 0x00,
-			0xff, 0x00, 0x12, 0x34,
+		0xfe, 0x80, 0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x12, 0x34,
 		},
 	};
 	addrtostr(&addr, buffer, sizeof(buffer));
diff -uNrwB radvd-2.16/TODO radvd-2.17/TODO
--- radvd-2.16/TODO	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/TODO	2017-07-02 06:58:35.000000000 +0500
@@ -58,3 +58,20 @@
    Ethernet frames with the old MAC until interface is flapped.
    More: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508466
 
+AdvRASolicitedUnicast: Further improvement is possible.
+- If we get a RS and are about to send a multicast RA, then we can further save
+  battery on the client device by NOT sending a unicast response, and just
+  letting the client wait for the multicast response. This should be
+  implemented as a new time value, specifying the maximum amount of time
+  remaining to as a deciding factor between send-solicited-RA-now vs
+  wait-for-next-multicast.
+- The above can also form part of rate-limiting of unicast RA responses when
+  network topology has recently changed.
+
+The following parts of RFC7222 are not yet implemented:
+- Section 5.1.3: Networks that serve battery-powered devices SHOULD NOT send
+  multicast RAs too frequently (see Section 4) unless the information in the RA
+  packet has substantially changed.  If there is a desire to ensure that hosts
+  pick up configuration changes quickly, those networks MAY send frequent
+  Router Advertisements for a limited period of time (e.g., not more than one
+  minute) immediately after a configuration change.
diff -uNrwB radvd-2.16/util.c radvd-2.17/util.c
--- radvd-2.16/util.c	2017-01-03 04:36:40.000000000 +0500
+++ radvd-2.17/util.c	2017-06-29 09:32:02.000000000 +0500
@@ -152,8 +152,7 @@
 	}
 }
 
-__attribute__ ((format(printf, 1, 2)))
-char * strdupf(char const * format, ...)
+__attribute__((format(printf, 1, 2))) char *strdupf(char const *format, ...)
 {
 	va_list va;
 	va_start(va, format);
@@ -168,10 +167,7 @@
 	return strp;
 }
 
-double rand_between(double lower, double upper)
-{
-	return ((upper - lower) / (RAND_MAX + 1.0) * rand() + lower);
-}
+double rand_between(double lower, double upper) { return ((upper - lower) / (RAND_MAX + 1.0) * rand() + lower); }
 
 /* This assumes that str is not null and str_size > 0 */
 void addrtostr(struct in6_addr const *addr, char *str, size_t str_size)
@@ -191,9 +187,9 @@
 int check_rdnss_presence(struct AdvRDNSS *rdnss, struct in6_addr *addr)
 {
 	while (rdnss) {
-		if (!memcmp(&rdnss->AdvRDNSSAddr1, addr, sizeof(struct in6_addr))
-		    || !memcmp(&rdnss->AdvRDNSSAddr2, addr, sizeof(struct in6_addr))
-		    || !memcmp(&rdnss->AdvRDNSSAddr3, addr, sizeof(struct in6_addr)))
+		if (!memcmp(&rdnss->AdvRDNSSAddr1, addr, sizeof(struct in6_addr)) ||
+		    !memcmp(&rdnss->AdvRDNSSAddr2, addr, sizeof(struct in6_addr)) ||
+		    !memcmp(&rdnss->AdvRDNSSAddr3, addr, sizeof(struct in6_addr)))
 			return 1;	/* rdnss address found in the list */
 		rdnss = rdnss->next;
 	}
