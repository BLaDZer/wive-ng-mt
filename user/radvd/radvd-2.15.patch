diff -uNrwB radvd-2.14/CHANGES radvd-2.15/CHANGES
--- radvd-2.14/CHANGES	2016-07-05 17:34:20.000000000 +0500
+++ radvd-2.15/CHANGES	2016-09-25 01:18:47.000000000 +0500
@@ -1,3 +1,10 @@
+2016/09/24	Release v2.15
+
+2016/09/18	Moved auto prefix code from config file parse to send_ra.
+
+2016/08/08	Merged ARPHRD_6LOWPAN netlink query from <Alexander Aring>
+		Add systemd service file <Craig Andrews>
+
 2016/07/05	Fixed bug in new vs old address list comparison when
 		responding to netlink messages.
 		Release v2.14
diff -uNrwB radvd-2.14/configure radvd-2.15/configure
--- radvd-2.14/configure	2016-07-05 17:34:41.000000000 +0500
+++ radvd-2.15/configure	2016-09-25 01:21:36.000000000 +0500
@@ -1,6 +1,6 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.69 for radvd 2.14.
+# Generated by GNU Autoconf 2.69 for radvd 2.15.
 #
 #
 # Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
@@ -577,8 +577,8 @@
 # Identity of this package.
 PACKAGE_NAME='radvd'
 PACKAGE_TARNAME='radvd'
-PACKAGE_VERSION='2.14'
-PACKAGE_STRING='radvd 2.14'
+PACKAGE_VERSION='2.15'
+PACKAGE_STRING='radvd 2.15'
 PACKAGE_BUGREPORT=''
 PACKAGE_URL=''
 
@@ -623,6 +623,10 @@
 am__EXEEXT_TRUE
 LTLIBOBJS
 LIBOBJS
+HAVE_SYSTEMD_FALSE
+HAVE_SYSTEMD_TRUE
+systemdsystemunitdir
+SBINDIR
 LOG_FACILITY
 PATH_RADVD_LOG
 PATH_RADVD_PID
@@ -751,6 +755,7 @@
 with_pidfile
 with_configfile
 with_facility
+with_systemdsystemunitdir
 '
       ac_precious_vars='build_alias
 host_alias
@@ -1308,7 +1313,7 @@
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures radvd 2.14 to adapt to many kinds of systems.
+\`configure' configures radvd 2.15 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1379,7 +1384,7 @@
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of radvd 2.14:";;
+     short | recursive ) echo "Configuration of radvd 2.15:";;
    esac
   cat <<\_ACEOF
 
@@ -1402,6 +1407,8 @@
   --with-pidfile          Path to the radvd pidfile /var/run/radvd.pid
   --with-configfile       Path to the radvd config file SYSCONF/radvd.conf
   --with-facility         Syslog facility to use when using syslog logging
+  --with-systemdsystemunitdir=DIR
+                          Directory for systemd service files
 
 Some influential environment variables:
   CC          C compiler command
@@ -1493,7 +1500,7 @@
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-radvd configure 2.14
+radvd configure 2.15
 generated by GNU Autoconf 2.69
 
 Copyright (C) 2012 Free Software Foundation, Inc.
@@ -1858,7 +1865,7 @@
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by radvd $as_me 2.14, which was
+It was created by radvd $as_me 2.15, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
@@ -2833,7 +2840,7 @@
 
 # Define the identity of the package.
  PACKAGE='radvd'
- VERSION='2.14'
+ VERSION='2.15'
 
 
 cat >>confdefs.h <<_ACEOF
@@ -5767,9 +5774,181 @@
 
 
 
+# Default value for sbindir
+prefix_temp=$prefix
+exec_prefix_temp=$exec_prefix
+
+test "${prefix}" = "NONE" && prefix="${ac_default_prefix}"
+test "${exec_prefix}" = "NONE" && exec_prefix='${prefix}'
+
+# Initial Value is $exec_prefix/sbin
+sbintemp="${sbindir}"
+
+# Expands to $prefix/sbin
+eval sbintemp=\"${sbintemp}\"
+# Expands to /usr/local/sbin or /usr/sbin if --prefix is passed
+eval sbintemp=\"${sbintemp}\"
+SBINDIR=${sbintemp}
+
+
+
+
+
+
+
+
+
+
+if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
+	if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
+set dummy ${ac_tool_prefix}pkg-config; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_PKG_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+PKG_CONFIG=$ac_cv_path_PKG_CONFIG
+if test -n "$PKG_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG" >&5
+$as_echo "$PKG_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_path_PKG_CONFIG"; then
+  ac_pt_PKG_CONFIG=$PKG_CONFIG
+  # Extract the first word of "pkg-config", so it can be a program name with args.
+set dummy pkg-config; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_ac_pt_PKG_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $ac_pt_PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_ac_pt_PKG_CONFIG="$ac_pt_PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG
+if test -n "$ac_pt_PKG_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_pt_PKG_CONFIG" >&5
+$as_echo "$ac_pt_PKG_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_pt_PKG_CONFIG" = x; then
+    PKG_CONFIG=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    PKG_CONFIG=$ac_pt_PKG_CONFIG
+  fi
+else
+  PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
+fi
+
+fi
+if test -n "$PKG_CONFIG"; then
+	_pkg_min_version=0.9.0
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version" >&5
+$as_echo_n "checking pkg-config is at least version $_pkg_min_version... " >&6; }
+	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+		PKG_CONFIG=""
+	fi
+fi
+
+# Check whether --with-systemdsystemunitdir was given.
+if test "${with_systemdsystemunitdir+set}" = set; then :
+  withval=$with_systemdsystemunitdir;
+else
+  with_systemdsystemunitdir=auto
+fi
+
+if test "x$with_systemdsystemunitdir" = "xyes" -o "x$with_systemdsystemunitdir" = "xauto"; then :
+
+     def_systemdsystemunitdir=$($PKG_CONFIG --variable=systemdsystemunitdir systemd)
+
+     if test "x$def_systemdsystemunitdir" = "x"; then :
+  if test "x$with_systemdsystemunitdir" = "xyes"; then :
+  as_fn_error $? "systemd support requested but pkg-config unable to query systemd package" "$LINENO" 5
+fi
+    with_systemdsystemunitdir=no
+else
+  with_systemdsystemunitdir="$def_systemdsystemunitdir"
+fi
+fi
+if test "x$with_systemdsystemunitdir" != "xno"; then :
+  systemdsystemunitdir=$with_systemdsystemunitdir
+
+fi
+ if test "x$with_systemdsystemunitdir" != "xno"; then
+  HAVE_SYSTEMD_TRUE=
+  HAVE_SYSTEMD_FALSE='#'
+else
+  HAVE_SYSTEMD_TRUE='#'
+  HAVE_SYSTEMD_FALSE=
+fi
+
+
 ac_config_headers="$ac_config_headers config.h"
 
-ac_config_files="$ac_config_files Makefile redhat/radvd.spec"
+ac_config_files="$ac_config_files Makefile radvd.service redhat/radvd.spec"
 
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -5903,6 +6082,10 @@
   as_fn_error $? "conditional \"am__fastdepCC\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${HAVE_SYSTEMD_TRUE}" && test -z "${HAVE_SYSTEMD_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_SYSTEMD\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 
 : "${CONFIG_STATUS=./config.status}"
 ac_write_fail=0
@@ -6300,7 +6483,7 @@
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by radvd $as_me 2.14, which was
+This file was extended by radvd $as_me 2.15, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
@@ -6366,7 +6549,7 @@
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-radvd config.status 2.14
+radvd config.status 2.15
 configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
@@ -6498,6 +6681,7 @@
     "depfiles") CONFIG_COMMANDS="$CONFIG_COMMANDS depfiles" ;;
     "config.h") CONFIG_HEADERS="$CONFIG_HEADERS config.h" ;;
     "Makefile") CONFIG_FILES="$CONFIG_FILES Makefile" ;;
+    "radvd.service") CONFIG_FILES="$CONFIG_FILES radvd.service" ;;
     "redhat/radvd.spec") CONFIG_FILES="$CONFIG_FILES redhat/radvd.spec" ;;
 
   *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
diff -uNrwB radvd-2.14/configure.ac radvd-2.15/configure.ac
--- radvd-2.14/configure.ac	2016-07-05 17:34:20.000000000 +0500
+++ radvd-2.15/configure.ac	2016-09-25 01:18:56.000000000 +0500
@@ -13,7 +13,7 @@
 dnl
 
 dnl If adding rcX to version, be sure to separate with a '-' 
-AC_INIT(radvd, [2.14])
+AC_INIT(radvd, [2.15])
 AC_CONFIG_SRCDIR(radvd.c)
 AC_CANONICAL_SYSTEM
 AM_INIT_AUTOMAKE
@@ -201,8 +201,46 @@
 AC_SUBST(PATH_RADVD_LOG)
 AC_SUBST(LOG_FACILITY)
 
+# Default value for sbindir
+prefix_temp=$prefix
+exec_prefix_temp=$exec_prefix
+
+test "${prefix}" = "NONE" && prefix="${ac_default_prefix}"
+test "${exec_prefix}" = "NONE" && exec_prefix='${prefix}'
+
+# Initial Value is $exec_prefix/sbin
+sbintemp="${sbindir}"
+
+# Expands to $prefix/sbin
+eval sbintemp=\"${sbintemp}\"
+# Expands to /usr/local/sbin or /usr/sbin if --prefix is passed
+eval sbintemp=\"${sbintemp}\"
+SBINDIR=${sbintemp}
+
+AC_SUBST(SBINDIR)
+
+PKG_PROG_PKG_CONFIG
+AC_ARG_WITH([systemdsystemunitdir],
+     [AS_HELP_STRING([--with-systemdsystemunitdir=DIR], [Directory for systemd service files])],,
+     [with_systemdsystemunitdir=auto])
+AS_IF([test "x$with_systemdsystemunitdir" = "xyes" -o "x$with_systemdsystemunitdir" = "xauto"], [
+     def_systemdsystemunitdir=$($PKG_CONFIG --variable=systemdsystemunitdir systemd)
+
+     AS_IF([test "x$def_systemdsystemunitdir" = "x"],
+   [AS_IF([test "x$with_systemdsystemunitdir" = "xyes"],
+    [AC_MSG_ERROR([systemd support requested but pkg-config unable to query systemd package])])
+    with_systemdsystemunitdir=no],
+   [with_systemdsystemunitdir="$def_systemdsystemunitdir"])])
+AS_IF([test "x$with_systemdsystemunitdir" != "xno"],
+      [AC_SUBST([systemdsystemunitdir], [$with_systemdsystemunitdir])])
+AM_CONDITIONAL([HAVE_SYSTEMD], [test "x$with_systemdsystemunitdir" != "xno"])
+
 AM_CONFIG_HEADER(config.h)
-AC_OUTPUT(Makefile redhat/radvd.spec)
+AC_OUTPUT(
+	Makefile \
+	radvd.service \
+	redhat/radvd.spec\
+)
 
 cat << EOF
 
diff -uNrwB radvd-2.14/device-linux.c radvd-2.15/device-linux.c
--- radvd-2.14/device-linux.c	2015-11-19 18:58:52.000000000 +0500
+++ radvd-2.15/device-linux.c	2016-09-04 09:29:16.000000000 +0500
@@ -17,11 +17,16 @@
 #include "radvd.h"
 #include "defaults.h"
 #include "pathnames.h"
+#include "netlink.h"
 
 #ifndef IPV6_ADDR_LINKLOCAL
 #define IPV6_ADDR_LINKLOCAL   0x0020U
 #endif
 
+#ifndef ARPHRD_6LOWPAN
+#define ARPHRD_6LOWPAN	825	/* IPv6 over LoWPAN */
+#endif
+
 static char const *hwstr(unsigned short sa_family);
 
 /*
@@ -79,12 +84,21 @@
 		iface->sllao.if_maxmtu = -1;
 		break;
 #endif				/* ARPHDR_ARCNET */
-#ifdef ARPHRD_IEEE802154
-	case ARPHRD_IEEE802154:
-		iface->sllao.if_hwaddr_len = 64;
+	case ARPHRD_6LOWPAN:
+#ifdef HAVE_NETLINK
+		/* hwaddr length differs on some L2 type lets detect them */
+		iface->sllao.if_hwaddr_len = netlink_get_device_addr_len(iface);
+		if (iface->sllao.if_hwaddr_len != -1) {
+			iface->sllao.if_hwaddr_len *= 8;
 		iface->sllao.if_prefix_len = 64;
-		break;
+		} else {
+			iface->sllao.if_prefix_len = -1;
+		}
+#else
+		iface->sllao.if_hwaddr_len = -1;
+		iface->sllao.if_prefix_len = -1;
 #endif
+		break;
 	default:
 		iface->sllao.if_hwaddr_len = -1;
 		iface->sllao.if_prefix_len = -1;
@@ -382,6 +396,9 @@
 		rc = "ARPHRD_IEEE802154_PHY";
 		break;
 #endif
+	case ARPHRD_6LOWPAN:
+		rc = "ARPHRD_6LOWPAN";
+		break;
 	case ARPHRD_VOID:
 		rc = "ARPHRD_VOID";
 		break;
diff -uNrwB radvd-2.14/gram.y radvd-2.15/gram.y
--- radvd-2.14/gram.y	2015-11-30 21:09:44.000000000 +0500
+++ radvd-2.15/gram.y	2016-09-25 01:17:45.000000000 +0500
@@ -19,9 +19,6 @@
 #include "defaults.h"
 
 #define YYERROR_VERBOSE 1
-static int countbits(int b);
-static int count_mask(struct sockaddr_in6 *m);
-static struct in6_addr get_prefix6(struct in6_addr const *addr, struct in6_addr const *mask);
 
 #if 0 /* no longer necessary? */
 #ifndef HAVE_IN6_ADDR_S6_ADDR
@@ -375,84 +372,12 @@
 					ABORT;
 				}
 
-				if ( prefix->if6[0] && prefix->if6to4[0]) {
-					flog(LOG_ERR, "Base6Interface and Base6to4Interface are mutually exclusive at this time");
-					ABORT;
-				}
-
-				if ( prefix->if6to4[0] )
-				{
-					if (get_v4addr(prefix->if6to4, &dst) < 0)
-					{
-						flog(LOG_ERR, "interface %s has no IPv4 addresses, disabling 6to4 prefix", prefix->if6to4 );
-						prefix->enabled = 0;
-					}
-					else
-					{
-						*((uint16_t *)(prefix->Prefix.s6_addr)) = htons(0x2002);
-						memcpy( prefix->Prefix.s6_addr + 2, &dst, sizeof( dst ) );
-					}
-				}
-
 				if ( prefix->if6[0] )
 				{
-#ifndef HAVE_IFADDRS_H
-					flog(LOG_ERR, "Base6Interface not supported in %s, line %d", filename, num_lines);
-					ABORT;
-#else
-					struct ifaddrs *ifap = 0, *ifa = 0;
-					struct AdvPrefix *next = prefix->next;
-
 					if (prefix->PrefixLen != 64) {
 						flog(LOG_ERR, "only /64 is allowed with Base6Interface.  %s:%d", filename, num_lines);
 						ABORT;
 					}
-
-					if (getifaddrs(&ifap) != 0)
-						flog(LOG_ERR, "getifaddrs failed: %s", strerror(errno));
-
-					for (ifa = ifap; ifa; ifa = ifa->ifa_next) {
-						struct sockaddr_in6 *s6 = 0;
-						struct sockaddr_in6 *mask = (struct sockaddr_in6 *)ifa->ifa_netmask;
-						struct in6_addr base6prefix;
-						char buf[INET6_ADDRSTRLEN];
-						int i;
-
-						if (strncmp(ifa->ifa_name, prefix->if6, IFNAMSIZ))
-							continue;
-
-						if (ifa->ifa_addr->sa_family != AF_INET6)
-							continue;
-
-						s6 = (struct sockaddr_in6 *)(ifa->ifa_addr);
-
-						if (IN6_IS_ADDR_LINKLOCAL(&s6->sin6_addr))
-							continue;
-
-						base6prefix = get_prefix6(&s6->sin6_addr, &mask->sin6_addr);
-						for (i = 0; i < 8; ++i) {
-							prefix->Prefix.s6_addr[i] &= ~mask->sin6_addr.s6_addr[i];
-							prefix->Prefix.s6_addr[i] |= base6prefix.s6_addr[i];
-						}
-						memset(&prefix->Prefix.s6_addr[8], 0, 8);
-						prefix->AdvRouterAddr = 1;
-						prefix->AutoSelected = 1;
-						prefix->next = next;
-
-						if (inet_ntop(ifa->ifa_addr->sa_family, (void *)&(prefix->Prefix), buf, sizeof(buf)) == NULL)
-							flog(LOG_ERR, "%s: inet_ntop failed in %s, line %d!", ifa->ifa_name, filename, num_lines);
-						else
-							dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s from interface %s",
-								buf, prefix->PrefixLen, iface->props.name, ifa->ifa_name);
-
-						/* Taking only one prefix from the Base6Interface.  Taking more than one would require allocating new
-						   prefixes and building a list.  I'm not sure how to do that from here. So for now, break. */
-						break;
-					}
-
-					if (ifap)
-						freeifaddrs(ifap);
-#endif /* ifndef HAVE_IFADDRS_H */
 				}
 			}
 			$$ = prefix;
@@ -466,75 +391,8 @@
 			memset(&zeroaddr, 0, sizeof(zeroaddr));
 
 			if (!memcmp($2, &zeroaddr, sizeof(struct in6_addr))) {
-#ifndef HAVE_IFADDRS_H
-				flog(LOG_ERR, "invalid all-zeros prefix in %s, line %d", filename, num_lines);
-				ABORT;
-#else
-				struct ifaddrs *ifap = 0, *ifa = 0;
-				struct AdvPrefix *next = iface->AdvPrefixList;
-
-				while (next) {
-					if (next->AutoSelected) {
-						flog(LOG_ERR, "auto selecting prefixes works only once per interface.  See %s, line %d", filename, num_lines);
-						ABORT;
-					}
-					next = next->next;
-				}
-				next = 0;
-
-				dlog(LOG_DEBUG, 5, "all-zeros prefix in %s, line %d", filename, num_lines);
-
-				if (getifaddrs(&ifap) != 0)
-					flog(LOG_ERR, "getifaddrs failed: %s", strerror(errno));
-
-				for (ifa = ifap; ifa; ifa = ifa->ifa_next) {
-					struct sockaddr_in6 *s6 = (struct sockaddr_in6 *)ifa->ifa_addr;
-					struct sockaddr_in6 *mask = (struct sockaddr_in6 *)ifa->ifa_netmask;
-					char buf[INET6_ADDRSTRLEN];
-
-					if (strncmp(ifa->ifa_name, iface->props.name, IFNAMSIZ))
-						continue;
-
-					if (ifa->ifa_addr->sa_family != AF_INET6)
-						continue;
-
-					s6 = (struct sockaddr_in6 *)(ifa->ifa_addr);
-
-					if (IN6_IS_ADDR_LINKLOCAL(&s6->sin6_addr))
-						continue;
-
-					prefix = malloc(sizeof(struct AdvPrefix));
-
-					if (prefix == NULL) {
-						flog(LOG_CRIT, "malloc failed: %s", strerror(errno));
-						ABORT;
-					}
-
-					prefix_init_defaults(prefix);
-					prefix->Prefix = get_prefix6(&s6->sin6_addr, &mask->sin6_addr);
-					prefix->AdvRouterAddr = 1;
-					prefix->AutoSelected = 1;
-					prefix->next = next;
-					next = prefix;
-
-					if (prefix->PrefixLen == 0)
-						prefix->PrefixLen = count_mask(mask);
-
-					if (inet_ntop(ifa->ifa_addr->sa_family, (void *)&(prefix->Prefix), buf, sizeof(buf)) == NULL)
-						flog(LOG_ERR, "%s: inet_ntop failed in %s, line %d!", ifa->ifa_name, filename, num_lines);
-					else
-						dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s", buf, prefix->PrefixLen, ifa->ifa_name);
-				}
-
-				if (!prefix) {
-					flog(LOG_WARNING, "no auto-selected prefix on interface %s, disabling advertisements",  iface->props.name);
-				}
-
-				if (ifap)
-					freeifaddrs(ifap);
-#endif /* ifndef HAVE_IFADDRS_H */
+				flog(LOG_WARNING, "invalid all-zeros prefix in %s, line %d", filename, num_lines);
 			}
-			else {
 				prefix = malloc(sizeof(struct AdvPrefix));
 
 				if (prefix == NULL) {
@@ -554,7 +412,6 @@
 
 				memcpy(&prefix->Prefix, $2, sizeof(struct in6_addr));
 			}
-		}
 		;
 
 optional_prefixplist: /* empty */
@@ -569,74 +426,35 @@
 prefixparms	: T_AdvOnLink SWITCH ';'
 		{
 			if (prefix) {
-				if (prefix->AutoSelected) {
-					struct AdvPrefix *p = prefix;
-					do {
-						p->AdvOnLinkFlag = $2;
-						p = p->next;
-					} while (p && p->AutoSelected);
-				}
-				else
 					prefix->AdvOnLinkFlag = $2;
 			}
 		}
 		| T_AdvAutonomous SWITCH ';'
 		{
 			if (prefix) {
-				if (prefix->AutoSelected) {
-					struct AdvPrefix *p = prefix;
-					do {
-						p->AdvAutonomousFlag = $2;
-						p = p->next;
-					} while (p && p->AutoSelected);
-				}
-				else
 					prefix->AdvAutonomousFlag = $2;
 			}
 		}
 		| T_AdvRouterAddr SWITCH ';'
 		{
 			if (prefix) {
-				if (prefix->AutoSelected && $2 == 0)
-					flog(LOG_WARNING, "prefix automatically selected, AdvRouterAddr always enabled, ignoring config line %d", num_lines);
-				else
 					prefix->AdvRouterAddr = $2;
 			}
 		}
 		| T_AdvValidLifetime number_or_infinity ';'
 		{
 			if (prefix) {
-				if (prefix->AutoSelected) {
-					struct AdvPrefix *p = prefix;
-					do {
-						p->AdvValidLifetime = $2;
-						p->curr_validlft = $2;
-						p = p->next;
-					} while (p && p->AutoSelected);
-				}
-				else {
 					prefix->AdvValidLifetime = $2;
 					prefix->curr_validlft = $2;
 				}
 			}
-		}
 		| T_AdvPreferredLifetime number_or_infinity ';'
 		{
 			if (prefix) {
-				if (prefix->AutoSelected) {
-					struct AdvPrefix *p = prefix;
-					do {
-						p->AdvPreferredLifetime = $2;
-						p->curr_preferredlft = $2;
-						p = p->next;
-					} while (p && p->AutoSelected);
-				}
-				else {
 					prefix->AdvPreferredLifetime = $2;
 					prefix->curr_preferredlft = $2;
 				}
 			}
-		}
 		| T_DeprecatePrefix SWITCH ';'
 		{
 			if (prefix) {
@@ -651,28 +469,30 @@
 		}
 		| T_Base6Interface name ';'
 		{
-			if (prefix) {
-				if (prefix->AutoSelected) {
-					flog(LOG_ERR, "automatically selecting the prefix and Base6Interface are mutually exclusive");
+#ifndef HAVE_IFADDRS_H
+			flog(LOG_ERR, "Base6Interface not supported in %s, line %d", filename, num_lines);
 					ABORT;
-				} /* fallthrough */
+#else
+			if (prefix) {
 				dlog(LOG_DEBUG, 4, "using prefixes on interface %s for prefixes on interface %s", $2, iface->props.name);
 				strncpy(prefix->if6, $2, IFNAMSIZ-1);
 				prefix->if6[IFNAMSIZ-1] = '\0';
 			}
+#endif
 		}
 
 		| T_Base6to4Interface name ';'
 		{
-			if (prefix) {
-				if (prefix->AutoSelected) {
-					flog(LOG_ERR, "automatically selecting the prefix and Base6to4Interface are mutually exclusive");
+#ifndef HAVE_IFADDRS_H
+			flog(LOG_ERR, "Base6to4Interface not supported in %s, line %d", filename, num_lines);
 					ABORT;
-				} /* fallthrough */
+#else
+			if (prefix) {
 				dlog(LOG_DEBUG, 4, "using interface %s for 6to4 prefixes on interface %s", $2, iface->props.name);
 				strncpy(prefix->if6to4, $2, IFNAMSIZ-1);
 				prefix->if6to4[IFNAMSIZ-1] = '\0';
 			}
+#endif
 		}
 		;
 
@@ -1036,41 +856,6 @@
 
 %%
 
-static int countbits(int b)
-{
-	int count;
-
-	for (count = 0; b != 0; count++) {
-		b &= b - 1; // this clears the LSB-most set bit
-	}
-
-	return (count);
-}
-
-static int count_mask(struct sockaddr_in6 *m)
-{
-	struct in6_addr *in6 = &m->sin6_addr;
-	int i;
-	int count = 0;
-
-	for (i = 0; i < 16; ++i) {
-		count += countbits(in6->s6_addr[i]);
-	}
-	return count;
-}
-
-static struct in6_addr get_prefix6(struct in6_addr const *addr, struct in6_addr const *mask)
-{
-	struct in6_addr prefix = *addr;
-	int i = 0;
-
-	for (; i < 16; ++i) {
-		prefix.s6_addr[i] &= mask->s6_addr[i];
-	}
-
-	return prefix;
-}
-
 static void cleanup(void)
 {
 	if (iface) {
diff -uNrwB radvd-2.14/interface.c radvd-2.15/interface.c
--- radvd-2.14/interface.c	2016-04-03 04:31:48.000000000 +0500
+++ radvd-2.15/interface.c	2016-09-25 01:17:45.000000000 +0500
@@ -113,8 +113,6 @@
 	prefix->AdvPreferredLifetime = DFLT_AdvPreferredLifetime;
 	prefix->DeprecatePrefixFlag = DFLT_DeprecatePrefixFlag;
 	prefix->DecrementLifetimesFlag = DFLT_DecrementLifetimesFlag;
-	prefix->if6to4[0] = 0;
-	prefix->enabled = 1;
 
 	prefix->curr_validlft = prefix->AdvValidLifetime;
 	prefix->curr_preferredlft = prefix->AdvPreferredLifetime;
diff -uNrwB radvd-2.14/log.c radvd-2.15/log.c
--- radvd-2.14/log.c	2015-11-19 18:58:53.000000000 +0500
+++ radvd-2.15/log.c	2016-09-04 09:29:16.000000000 +0500
@@ -35,6 +35,8 @@
 	case L_NONE:
 	case L_STDERR:
 		break;
+	case L_STDERR_CLEAN:
+		/* fallthrough */
 	case L_STDERR_SYSLOG:
 		/* fallthrough */
 	case L_SYSLOG:
@@ -92,6 +94,10 @@
 		fprintf(stderr, "[%s] %s (%d): %s\n", tstamp, log_ident, getpid(), buff);
 		fflush(stderr);
 		break;
+	case L_STDERR_CLEAN:
+		fprintf(stderr, "%s\n", buff);
+		fflush(stderr);
+		break;
 	case L_LOGFILE:
 		current = time(NULL);
 		tm = localtime(&current);
diff -uNrwB radvd-2.14/log.h radvd-2.15/log.h
--- radvd-2.14/log.h	2015-11-19 18:58:53.000000000 +0500
+++ radvd-2.15/log.h	2016-09-04 09:29:16.000000000 +0500
@@ -19,6 +19,7 @@
 #define L_STDERR	2
 #define L_STDERR_SYSLOG	3
 #define L_LOGFILE	4
+#define L_STDERR_CLEAN	5
 
 #define LOG_TIME_FORMAT "%b %d %H:%M:%S"
 
diff -uNrwB radvd-2.14/Makefile.am radvd-2.15/Makefile.am
--- radvd-2.14/Makefile.am	2015-11-19 18:58:52.000000000 +0500
+++ radvd-2.15/Makefile.am	2016-09-04 09:29:16.000000000 +0500
@@ -150,12 +150,13 @@
 	radvd.8.man \
 	radvd.conf.5.man \
 	radvd.conf.example \
+	radvd.service.in \
 	radvdump.8.man \
+	redhat/radvd-tmpfs.conf \
 	redhat/radvd.conf.empty \
 	redhat/radvd.init \
 	redhat/radvd.spec \
 	redhat/radvd.sysconfig \
-	redhat/radvd-tmpfs.conf \
 	test/check.c \
 	test/print_safe_buffer.c \
 	test/print_safe_buffer.h \
@@ -271,3 +272,11 @@
 	@CHECK_LIBS@ \
 	@CONDITIONAL_SOURCES@ \
 	libradvd-parser.a
+
+DISTCHECK_CONFIGURE_FLAGS = \
+  --with-systemdsystemunitdir=$$dc_install_base/$(systemdsystemunitdir)
+
+if HAVE_SYSTEMD
+systemdsystemunit_DATA = radvd.service
+endif
+
diff -uNrwB radvd-2.14/Makefile.in radvd-2.15/Makefile.in
--- radvd-2.14/Makefile.in	2016-07-05 17:34:42.000000000 +0500
+++ radvd-2.15/Makefile.in	2016-09-25 01:21:37.000000000 +0500
@@ -121,7 +122,7 @@
  configure.lineno config.status.lineno
 mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = config.h
-CONFIG_CLEAN_FILES = redhat/radvd.spec
+CONFIG_CLEAN_FILES = radvd.service redhat/radvd.spec
 CONFIG_CLEAN_VPATH_FILES =
 LIBRARIES = $(noinst_LIBRARIES)
 AR = ar
@@ -136,7 +137,7 @@
 	libradvd_parser_a-scanner.$(OBJEXT)
 libradvd_parser_a_OBJECTS = $(am_libradvd_parser_a_OBJECTS)
 am__installdirs = "$(DESTDIR)$(sbindir)" "$(DESTDIR)$(man5dir)" \
-	"$(DESTDIR)$(man8dir)"
+	"$(DESTDIR)$(man8dir)" "$(DESTDIR)$(systemdsystemunitdir)"
 PROGRAMS = $(sbin_PROGRAMS)
 am__dirstamp = $(am__leading_dot)dirstamp
 am_check_all_OBJECTS = test/check_all-print_safe_buffer.$(OBJEXT) \
@@ -245,6 +246,7 @@
 man8dir = $(mandir)/man8
 NROFF = nroff
 MANS = $(man_MANS)
+DATA = $(systemdsystemunit_DATA)
 am__tagged_files = $(HEADERS) $(SOURCES) $(TAGS_FILES) \
 	$(LISP)config.h.in
 # Read a list of newline-separated strings from the standard input,
@@ -444,9 +446,9 @@
 TEST_LOG_COMPILE = $(TEST_LOG_COMPILER) $(AM_TEST_LOG_FLAGS) \
 	$(TEST_LOG_FLAGS)
 am__DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/config.h.in \
-	$(top_srcdir)/redhat/radvd.spec.in README TODO compile \
-	config.guess config.sub depcomp gram.c gram.h install-sh \
-	missing scanner.c test-driver ylwrap
+	$(srcdir)/radvd.service.in $(top_srcdir)/redhat/radvd.spec.in \
+	README TODO compile config.guess config.sub depcomp gram.c \
+	gram.h install-sh missing scanner.c test-driver ylwrap
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 distdir = $(PACKAGE)-$(VERSION)
 top_distdir = $(distdir)
@@ -531,6 +533,7 @@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
 RANLIB = @RANLIB@
 RM = @RM@
+SBINDIR = @SBINDIR@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
@@ -585,6 +588,7 @@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+systemdsystemunitdir = @systemdsystemunitdir@
 target = @target@
 target_alias = @target_alias@
 target_cpu = @target_cpu@
@@ -681,12 +685,13 @@
 	radvd.8.man \
 	radvd.conf.5.man \
 	radvd.conf.example \
+	radvd.service.in \
 	radvdump.8.man \
+	redhat/radvd-tmpfs.conf \
 	redhat/radvd.conf.empty \
 	redhat/radvd.init \
 	redhat/radvd.spec \
 	redhat/radvd.sysconfig \
-	redhat/radvd-tmpfs.conf \
 	test/check.c \
 	test/print_safe_buffer.c \
 	test/print_safe_buffer.h \
@@ -741,6 +746,10 @@
 	@CONDITIONAL_SOURCES@ \
 	libradvd-parser.a
 
+DISTCHECK_CONFIGURE_FLAGS = \
+  --with-systemdsystemunitdir=$$dc_install_base/$(systemdsystemunitdir)
+
+@HAVE_SYSTEMD_TRUE@systemdsystemunit_DATA = radvd.service
 all: config.h
 	$(MAKE) $(AM_MAKEFLAGS) all-am
 
@@ -794,6 +803,8 @@
 
 distclean-hdr:
 	-rm -f config.h stamp-h1
+radvd.service: $(top_builddir)/config.status $(srcdir)/radvd.service.in
+	cd $(top_builddir) && $(SHELL) ./config.status $@
 redhat/radvd.spec: $(top_builddir)/config.status $(top_srcdir)/redhat/radvd.spec.in
 	cd $(top_builddir) && $(SHELL) ./config.status $@
 
@@ -1212,6 +1223,27 @@
 	} | sed -e 's,.*/,,;h;s,.*\.,,;s,^[^8][0-9a-z]*$$,8,;x' \
 	      -e 's,\.[0-9a-z]*$$,,;$(transform);G;s,\n,.,'`; \
 	dir='$(DESTDIR)$(man8dir)'; $(am__uninstall_files_from_dir)
+install-systemdsystemunitDATA: $(systemdsystemunit_DATA)
+	@$(NORMAL_INSTALL)
+	@list='$(systemdsystemunit_DATA)'; test -n "$(systemdsystemunitdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(systemdsystemunitdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(systemdsystemunitdir)" || exit 1; \
+	fi; \
+	for p in $$list; do \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  echo "$$d$$p"; \
+	done | $(am__base_list) | \
+	while read files; do \
+	  echo " $(INSTALL_DATA) $$files '$(DESTDIR)$(systemdsystemunitdir)'"; \
+	  $(INSTALL_DATA) $$files "$(DESTDIR)$(systemdsystemunitdir)" || exit $$?; \
+	done
+
+uninstall-systemdsystemunitDATA:
+	@$(NORMAL_UNINSTALL)
+	@list='$(systemdsystemunit_DATA)'; test -n "$(systemdsystemunitdir)" || list=; \
+	files=`for p in $$list; do echo $$p; done | sed -e 's|^.*/||'`; \
+	dir='$(DESTDIR)$(systemdsystemunitdir)'; $(am__uninstall_files_from_dir)
 
 ID: $(am__tagged_files)
 	$(am__define_uniq_tagged_files); mkid -fID $$unique
@@ -1605,9 +1637,9 @@
 	$(MAKE) $(AM_MAKEFLAGS) $(check_PROGRAMS)
 	$(MAKE) $(AM_MAKEFLAGS) check-TESTS
 check: check-am
-all-am: Makefile $(LIBRARIES) $(PROGRAMS) $(MANS) config.h
+all-am: Makefile $(LIBRARIES) $(PROGRAMS) $(MANS) $(DATA) config.h
 installdirs:
-	for dir in "$(DESTDIR)$(sbindir)" "$(DESTDIR)$(man5dir)" "$(DESTDIR)$(man8dir)"; do \
+	for dir in "$(DESTDIR)$(sbindir)" "$(DESTDIR)$(man5dir)" "$(DESTDIR)$(man8dir)" "$(DESTDIR)$(systemdsystemunitdir)"; do \
 	  test -z "$$dir" || $(MKDIR_P) "$$dir"; \
 	done
 install: install-am
@@ -1671,7 +1703,7 @@
 
 info-am:
 
-install-data-am: install-man
+install-data-am: install-man install-systemdsystemunitDATA
 
 install-dvi: install-dvi-am
 
@@ -1718,7 +1750,8 @@
 
 ps-am:
 
-uninstall-am: uninstall-man uninstall-sbinPROGRAMS
+uninstall-am: uninstall-man uninstall-sbinPROGRAMS \
+	uninstall-systemdsystemunitDATA
 
 uninstall-man: uninstall-man5 uninstall-man8
 
@@ -1736,12 +1769,13 @@
 	install-exec install-exec-am install-html install-html-am \
 	install-info install-info-am install-man install-man5 \
 	install-man8 install-pdf install-pdf-am install-ps \
-	install-ps-am install-sbinPROGRAMS install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic pdf pdf-am ps ps-am recheck tags tags-am \
-	uninstall uninstall-am uninstall-man uninstall-man5 \
-	uninstall-man8 uninstall-sbinPROGRAMS
+	install-ps-am install-sbinPROGRAMS install-strip \
+	install-systemdsystemunitDATA installcheck installcheck-am \
+	installdirs maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-compile mostlyclean-generic pdf pdf-am \
+	ps ps-am recheck tags tags-am uninstall uninstall-am \
+	uninstall-man uninstall-man5 uninstall-man8 \
+	uninstall-sbinPROGRAMS uninstall-systemdsystemunitDATA
 
 .PRECIOUS: Makefile
 
diff -uNrwB radvd-2.14/netlink.c radvd-2.15/netlink.c
--- radvd-2.14/netlink.c	2016-07-05 17:34:20.000000000 +0500
+++ radvd-2.15/netlink.c	2016-09-04 09:29:16.000000000 +0500
@@ -32,6 +32,68 @@
 #define SOL_NETLINK	270
 #endif
 
+struct iplink_req {
+	struct nlmsghdr		n;
+	struct ifinfomsg	i;
+	char			buf[1024];
+};
+
+int netlink_get_device_addr_len(struct Interface *iface)
+{
+	struct iplink_req req = {};
+	struct iovec iov = { &req, sizeof(req) };
+	struct sockaddr_nl sa = {};
+	struct msghdr msg = { (void *)&sa, sizeof(sa), &iov, 1, NULL, 0, 0 };
+	int sock, len, addr_len = -1;
+	unsigned short type;
+	char answer[32768];
+	struct rtattr *tb;
+
+	/* nl_pid (for linux kernel) and nl_groups (unicast) should be zero */
+	sa.nl_family = AF_NETLINK;
+	req.n.nlmsg_len = NLMSG_LENGTH(sizeof(struct ifinfomsg));
+	req.n.nlmsg_flags = NLM_F_REQUEST;
+	req.n.nlmsg_type = RTM_GETLINK;
+	req.i.ifi_index = iface->props.if_index;
+
+	sock = netlink_socket();
+	if (sock == -1)
+		return -1;
+
+	len = sendmsg(sock, &msg, 0);
+	if (len == -1) {
+		flog(LOG_ERR, "netlink: sendmsg for addr_len failed: %s", strerror(errno));
+		goto out;
+	}
+
+	iov.iov_base = answer;
+	iov.iov_len = sizeof(answer);
+	len = recvmsg(sock, &msg, 0);
+	if (len == -1) {
+		flog(LOG_ERR, "netlink: recvmsg for addr_len failed: %s", strerror(errno));
+		goto out;
+	}
+
+	if (len < NLMSG_LENGTH(sizeof(struct ifinfomsg)))
+		goto out;
+	len -= NLMSG_LENGTH(sizeof(struct ifinfomsg));
+
+	tb = (struct rtattr *)(answer + NLMSG_LENGTH(sizeof(struct ifinfomsg)));
+	while (RTA_OK(tb, len)) {
+		type = tb->rta_type & ~NLA_F_NESTED;
+		if (type == IFLA_ADDRESS) {
+			addr_len = RTA_PAYLOAD(tb);
+			break;
+		}
+		tb = RTA_NEXT(tb, len);
+	}
+
+out:
+	close(sock);
+
+	return addr_len;
+}
+
 void process_netlink_msg(int sock, struct Interface * ifaces)
 {
 	char buf[4096];
diff -uNrwB radvd-2.14/netlink.h radvd-2.15/netlink.h
--- radvd-2.14/netlink.h	2015-11-19 18:58:53.000000000 +0500
+++ radvd-2.15/netlink.h	2016-09-04 09:29:16.000000000 +0500
@@ -17,5 +17,6 @@
 
 #include "radvd.h"
 
+int netlink_get_device_addr_len(struct Interface *iface);
 void process_netlink_msg(int sock, struct Interface * ifaces);
 int netlink_socket(void);
diff -uNrwB radvd-2.14/process.c radvd-2.15/process.c
--- radvd-2.14/process.c	2016-04-03 04:31:48.000000000 +0500
+++ radvd-2.15/process.c	2016-09-25 01:17:45.000000000 +0500
@@ -255,7 +255,7 @@
 				struct AdvPrefix *prefix = iface->AdvPrefixList;
 				while (prefix) {
 					char prefix_str[INET6_ADDRSTRLEN];
-					if (prefix->enabled && (prefix->PrefixLen == pinfo->nd_opt_pi_prefix_len)
+					if ((prefix->PrefixLen == pinfo->nd_opt_pi_prefix_len)
 					    && addr_match(&prefix->Prefix, &pinfo->nd_opt_pi_prefix, prefix->PrefixLen)) {
 						addrtostr(&prefix->Prefix, prefix_str, sizeof(prefix_str));
 
diff -uNrwB radvd-2.14/radvd.c radvd-2.15/radvd.c
--- radvd-2.14/radvd.c	2016-03-31 11:31:20.000000000 +0500
+++ radvd-2.15/radvd.c	2016-09-04 09:29:16.000000000 +0500
@@ -37,7 +37,8 @@
 "  -f, --facility=NUM      Set the logging facility.\n"
 "  -h, --help              Show this help screen.\n"
 "  -l, --logfile=PATH      Set the log file.\n"
-"  -m, --logmethod=X       Set method to: syslog, stderr, stderr_syslog, logfile, or none.\n"
+"  -m, --logmethod=X       Set method to: syslog, stderr, stderr_syslog, logfile,\n"
+"                          stderr_clean, or none.\n"
 "  -n, --nodaemon          Prevent the daemonizing.\n"
 "  -p, --pidfile=PATH      Set the pid file.\n"
 "  -t, --chrootdir=PATH    Chroot to the specified path.\n"
@@ -231,6 +232,8 @@
 				log_method = L_STDERR_SYSLOG;
 			} else if (!strcmp(optarg, "stderr")) {
 				log_method = L_STDERR;
+			} else if (!strcmp(optarg, "stderr_clean")) {
+				log_method = L_STDERR_CLEAN;
 			} else if (!strcmp(optarg, "logfile")) {
 				log_method = L_LOGFILE;
 			} else if (!strcmp(optarg, "none")) {
@@ -289,7 +292,18 @@
 
 	if (configtest) {
 		set_debuglevel(1);
+		switch (log_method) {
+			case L_STDERR:
+			case L_STDERR_CLEAN:
+				break;
+			case L_STDERR_SYSLOG:
+			case L_NONE:
+			case L_SYSLOG:
+			case L_LOGFILE:
+			default:
 		log_method = L_STDERR;
+			break;
+		}
 	}
 
 	if (log_open(log_method, pname, logfile, facility) < 0) {
diff -uNrwB radvd-2.14/radvd.h radvd-2.15/radvd.h
--- radvd-2.14/radvd.h	2016-04-03 04:31:48.000000000 +0500
+++ radvd-2.15/radvd.h	2016-09-25 01:17:45.000000000 +0500
@@ -144,8 +144,6 @@
 
 	/* 6to4 etc. extensions */
 	char if6to4[IFNAMSIZ];
-	int enabled;
-	int AutoSelected;
 
 	/* Select prefixes from this interface. */
 	char if6[IFNAMSIZ];
@@ -310,6 +308,9 @@
 int recv_rs_ra(int sock, unsigned char *, struct sockaddr_in6 *, struct in6_pktinfo **, int *, unsigned char*);
 
 /* util.c */
+int countbits(int b);
+int count_mask(struct sockaddr_in6 *m);
+struct in6_addr get_prefix6(struct in6_addr const *addr, struct in6_addr const *mask);
 char * strdupf(char const * format, ...) __attribute__ ((format(printf, 1, 2)));
 double rand_between(double, double);
 int check_dnssl_presence(struct AdvDNSSL *, const char *);
diff -uNrwB radvd-2.14/radvd.service.in radvd-2.15/radvd.service.in
--- radvd-2.14/radvd.service.in	1970-01-01 05:00:00.000000000 +0500
+++ radvd-2.15/radvd.service.in	2016-09-04 09:29:16.000000000 +0500
@@ -0,0 +1,45 @@
+# It's not recommended to modify this file in-place, because it
+# will be overwritten during upgrades.  If you want to customize,
+# the best way is to use the "systemctl edit" command.
+
+[Unit]
+Description=Router advertisement daemon for IPv6
+Documentation=man:radvd(8)
+After=network.target
+
+[Service]
+Type=forking
+ExecStartPre=@SBINDIR@/radvd --logmethod stderr_clean --configtest
+ExecStart=@SBINDIR@/radvd --logmethod stderr_clean
+ExecReload=@SBINDIR@/radvd --logmethod stderr_clean --configtest && /bin/kill -HUP $MAINPID
+PIDFile=@PATH_RADVD_PID@
+
+# Set the CPU scheduling policy to idle which is for running very low priority background jobs
+CPUSchedulingPolicy=idle
+
+# Allow for binding to low ports and doing raw network access
+CapabilityBoundingSet=CAP_NET_BIND_SERVICE  CAP_NET_RAW
+
+# Set up a new file system namespace and mounts private /tmp and /var/tmp directories
+# so this service cannot access the global directories and other processes cannot
+# access this service's directories.
+PrivateTmp=yes
+
+# Sets up a new /dev namespace for the executed processes and only adds API pseudo devices
+# such as /dev/null, /dev/zero or /dev/random (as well as the pseudo TTY subsystem) to it,
+# but no physical devices such as /dev/sda.
+PrivateDevices=yes
+
+# Mounts the /usr, /boot, and /etc directories read-only for processes invoked by this unit.
+ProtectSystem=full
+
+# The directories /home, /root and /run/user are made inaccessible and empty for processes
+# invoked by this unit.
+ProtectHome=yes
+
+# Ensures that the service process and all its children can never gain new privileges
+NoNewPrivileges=yes
+
+[Install]
+WantedBy=multi-user.target
+
diff -uNrwB radvd-2.14/redhat/radvd.spec radvd-2.15/redhat/radvd.spec
--- radvd-2.14/redhat/radvd.spec	2016-07-05 17:34:46.000000000 +0500
+++ radvd-2.15/redhat/radvd.spec	2016-09-25 01:21:42.000000000 +0500
@@ -5,7 +5,7 @@
 
 Summary: A Router Advertisement daemon
 Name: radvd
-Version: 2.14
+Version: 2.15
 Release: 1
 # The code includes the advertising clause, so it's GPL-incompatible
 License: BSD with advertising
diff -uNrwB radvd-2.14/send.c radvd-2.15/send.c
--- radvd-2.14/send.c	2015-11-19 18:58:53.000000000 +0500
+++ radvd-2.15/send.c	2016-09-25 01:17:45.000000000 +0500
@@ -26,7 +26,8 @@
 static void update_iface_times(struct Interface * iface);
 
 static void add_ra_header(struct safe_buffer * sb, struct ra_header_info const * ra_header_info, int cease_adv);
-static void add_prefix(struct safe_buffer * sb, struct AdvPrefix const * prefix, int cease_adv);
+static void add_prefixs(struct safe_buffer * sb, char const * ifname, struct AdvPrefix const * prefix, int cease_adv);
+static void add_one_prefix(struct safe_buffer * sb, char const * ifname, struct AdvPrefix const * prefix, int cease_adv);
 static void add_route(struct safe_buffer * sb, struct AdvRoute const *route, int cease_adv);
 static void add_rdnss(struct safe_buffer * sb, struct AdvRDNSS const *rdnss, int cease_adv);
 static size_t serialize_domain_names(struct safe_buffer * safe_buffer, struct AdvDNSSL const *dnssl);
@@ -138,7 +139,7 @@
 
 	struct AdvPrefix *prefix = iface->AdvPrefixList;
 	while (prefix) {
-		if (prefix->enabled && (!prefix->DecrementLifetimesFlag || prefix->curr_preferredlft > 0)) {
+		if ((!prefix->DecrementLifetimesFlag || prefix->curr_preferredlft > 0)) {
 			if (!(iface->state_info.cease_adv && prefix->DeprecatePrefixFlag)) {
 				if (prefix->DecrementLifetimesFlag) {
 
@@ -191,10 +192,8 @@
 	safe_buffer_append(sb, &radvert, sizeof(radvert));
 }
 
-static void add_prefix(struct safe_buffer * sb, struct AdvPrefix const *prefix, int cease_adv)
+static void add_one_prefix(struct safe_buffer * sb, char const * ifname, struct AdvPrefix const * prefix, int cease_adv)
 {
-	while (prefix) {
-		if (prefix->enabled && (!prefix->DecrementLifetimesFlag || prefix->curr_preferredlft > 0)) {
 			struct nd_opt_prefix_info pinfo;
 
 			memset(&pinfo, 0, sizeof(pinfo));
@@ -225,6 +224,99 @@
 
 			safe_buffer_append(sb, &pinfo, sizeof(pinfo));
 		}
+static void add_auto_prefixes_6to4(struct safe_buffer * sb, char const * ifname, struct AdvPrefix const *prefix, int cease_adv)
+{
+#ifdef HAVE_IFADDRS_H
+	struct AdvPrefix xprefix = *prefix;
+	unsigned int dst;
+	if (get_v4addr(prefix->if6to4, &dst) < 0) {
+		flog(LOG_ERR, "Base6to4interface %s has no IPv4 addresses", prefix->if6to4);
+	} else {
+		memcpy(xprefix.Prefix.s6_addr + 2, &dst, sizeof(dst));
+		*((uint16_t *)(xprefix.Prefix.s6_addr)) = htons(0x2002);
+		xprefix.PrefixLen = 64;
+
+		char pfx_str[INET6_ADDRSTRLEN];
+		addrtostr(&xprefix.Prefix, pfx_str, sizeof(pfx_str));
+		dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s",
+			pfx_str, xprefix.PrefixLen, ifname);
+
+		/* TODO: Something must be done with these. */
+		(void)xprefix.curr_validlft;
+		(void)xprefix.curr_preferredlft;
+
+		add_one_prefix(sb, ifname, &xprefix, cease_adv);
+	}
+#endif
+}
+
+
+static void add_auto_prefixes(struct safe_buffer * sb, char const * ifname, struct AdvPrefix const *prefix, int cease_adv)
+{
+#ifdef HAVE_IFADDRS_H
+	struct AdvPrefix xprefix;
+	struct ifaddrs *ifap = 0, *ifa = 0;
+
+	if (getifaddrs(&ifap) != 0)
+		flog(LOG_ERR, "getifaddrs failed: %s", strerror(errno));
+
+	for (ifa = ifap; ifa; ifa = ifa->ifa_next) {
+
+		if (strncmp(ifa->ifa_name, ifname, IFNAMSIZ))
+			continue;
+
+		if (ifa->ifa_addr->sa_family != AF_INET6)
+			continue;
+
+		struct sockaddr_in6 *s6 = (struct sockaddr_in6 *)ifa->ifa_addr;
+		struct sockaddr_in6 *mask = (struct sockaddr_in6 *)ifa->ifa_netmask;
+
+		if (IN6_IS_ADDR_LINKLOCAL(&s6->sin6_addr))
+			continue;
+
+		xprefix = *prefix;
+		xprefix.Prefix = get_prefix6(&s6->sin6_addr, &mask->sin6_addr);
+		xprefix.PrefixLen = count_mask(mask);
+
+		char pfx_str[INET6_ADDRSTRLEN];
+		addrtostr(&xprefix.Prefix, pfx_str, sizeof(pfx_str));
+		dlog(LOG_DEBUG, 3, "auto-selected prefix %s/%d on interface %s",
+			pfx_str, xprefix.PrefixLen, ifname);
+
+		/* TODO: Something must be done with these. */
+		(void)xprefix.curr_validlft;
+		(void)xprefix.curr_preferredlft;
+
+		add_one_prefix(sb, ifname, &xprefix, cease_adv);
+	}
+
+	if (ifap)
+		freeifaddrs(ifap);
+#endif
+}
+
+static void add_prefixs(struct safe_buffer * sb, char const * ifname, struct AdvPrefix const *prefix, int cease_adv)
+{
+	while (prefix) {
+		if ((!prefix->DecrementLifetimesFlag || prefix->curr_preferredlft > 0)) {
+			struct in6_addr zero = {};
+			if (prefix->if6to4[0] || prefix->if6[0] || 0 == memcmp(&prefix->Prefix, &zero, sizeof(zero))) {
+				if (prefix->if6to4[0]) {
+					dlog(LOG_DEBUG, 4, "if6to4 auto prefix detected on iface %s", ifname);
+					add_auto_prefixes_6to4(sb, prefix->if6to4, prefix, cease_adv);
+				}
+				if (prefix->if6[0]) {
+					dlog(LOG_DEBUG, 4, "if6 auto prefix detected on iface %s", ifname);
+					add_auto_prefixes(sb, prefix->if6, prefix, cease_adv);
+				}
+				if (0 == memcmp(&prefix->Prefix, &zero, sizeof(zero))) {
+					dlog(LOG_DEBUG, 4, "::/64 auto prefix detected on iface %s", ifname);
+					add_auto_prefixes(sb, ifname, prefix, cease_adv);
+				}
+			} else {
+				add_one_prefix(sb, ifname, prefix, cease_adv);
+			}
+		}
 
 		prefix = prefix->next;
 	}
@@ -579,7 +671,7 @@
 	add_ra_header(sb, &iface->ra_header_info, iface->state_info.cease_adv);
 
 	if (iface->AdvPrefixList) {
-		add_prefix(sb, iface->AdvPrefixList, iface->state_info.cease_adv);
+		add_prefixs(sb, iface->props.name, iface->AdvPrefixList, iface->state_info.cease_adv);
 	}
 
 	if (iface->AdvRouteList) {
diff -uNrwB radvd-2.14/test/send.c radvd-2.15/test/send.c
--- radvd-2.14/test/send.c	2015-11-19 18:58:53.000000000 +0500
+++ radvd-2.15/test/send.c	2016-09-25 01:17:45.000000000 +0500
@@ -61,7 +61,7 @@
 	ck_assert_ptr_ne(0, iface);
 
 	struct safe_buffer sb = SAFE_BUFFER_INIT;
-	add_prefix(&sb, iface->AdvPrefixList, iface->state_info.cease_adv);
+	add_prefixs(&sb, iface->props.name, iface->AdvPrefixList, iface->state_info.cease_adv);
 
 #ifdef PRINT_SAFE_BUFFER
 	print_safe_buffer(&sb);
diff -uNrwB radvd-2.14/util.c radvd-2.15/util.c
--- radvd-2.14/util.c	2015-11-19 18:58:53.000000000 +0500
+++ radvd-2.15/util.c	2016-09-25 01:17:45.000000000 +0500
@@ -171,3 +171,40 @@
 	}
 	return n;
 }
+
+int countbits(int b)
+{
+	int count;
+
+	for (count = 0; b != 0; count++) {
+		b &= b - 1; // this clears the LSB-most set bit
+	}
+
+	return (count);
+}
+
+int count_mask(struct sockaddr_in6 *m)
+{
+	struct in6_addr *in6 = &m->sin6_addr;
+	int i;
+	int count = 0;
+
+	for (i = 0; i < 16; ++i) {
+		count += countbits(in6->s6_addr[i]);
+	}
+	return count;
+}
+
+struct in6_addr get_prefix6(struct in6_addr const *addr, struct in6_addr const *mask)
+{
+	struct in6_addr prefix = *addr;
+	int i = 0;
+
+	for (; i < 16; ++i) {
+		prefix.s6_addr[i] &= mask->s6_addr[i];
+	}
+
+	return prefix;
+}
+
+
