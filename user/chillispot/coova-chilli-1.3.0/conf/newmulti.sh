#!/bin/sh

DEVICE=$1

ifconfig $DEVICE 0.0.0.0 2>/dev/null || {
    echo "$0 <subscriber-lan-device>"
    echo "create a vlan interface with:"
    echo "  vconfig add <interface> <vlan-id>"
    exit
}

[ -d  /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/$DEVICE ] || mkdir /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/$DEVICE

cat > /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/$DEVICE/chilli.conf <<EOF
# Generated by $0
include /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/$DEVICE/main.conf
include /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/$DEVICE/hs.conf
include /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/$DEVICE/local.conf

ipup=/opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/up.sh
ipdown=/opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/down.sh
EOF

cat /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/config | \
    grep -v HS_LANIF > /opt/Wive-MT/user/chillispot/coova-chilli-1.3.0/filesystem/etc/chilli/$DEVICE/config